---
emoji: 🤦‍♂️
title: 쿠버네티스의 아키텍쳐 [Kubernetes]
date: "2021-06-29 00:07:14"
author: nasa1515
tags: Kubernetes
categories: Kubernetes
---


머리말 

이전 포스트에서 쿠버네티스의 기본적인 컴포넌트 개념에 대해서 정리 해보았습니다.  
이번에는 실습에 들어가기 앞서 아키텍쳐의 개념을 잡고 들어가기위해서  
조대협님의 블로그 글을 참고하여 제 식대로 다시 정리 해보았습니다.  


---

참고  :  [조대협님 블로그](https://bcho.tistory.com/1258?category=731548)
 
---



## ✔ 아키텍쳐 개념정리 


이전 포스트에서 쿠버네티스에 대한 개념 이해가 끝났으면  
이제 쿠버네티스가 실제로 어떤 구조로 구현이 되어 있는지 아키텍쳐를 살펴보도록 하자.   
아키텍쳐를 이용하면 동작 원리를 이해할 수 있기 때문에 쿠버네티스의 사용법을 이해하는데 도움이 된다.

(kubernetes의 아키텍쳐)  
![스크린샷, 2020-09-16 11-45-17](https://user-images.githubusercontent.com/69498804/93286404-1eea6900-f812-11ea-8a90-dc6e79166d83.png)

<br/>


## ✌ 마스터와 노드  

쿠버네티스는 크게 마스터(Master)와 노드(Node) 두 개의 컴포넌트로 분리된다.

마스터는 쿠버네티스의 설정 환경을 저장하고 전체 클러스터를 관리하는 역할을 맏고  
노드는 파드나 컨테이너 처럼 쿠버네티스 위에서 동작하는 워크로드를 호스팅하는 역할을 한다.

<br/>

### 마스터
    
쿠버네티스 클러스터 전체를 컨트럴 하는 시스템 크게 API 서버, 스케쥴러, 컨트롤러 매니져, etcd 로 구성되어 있다.

* ``API 서버``  

    쿠버네티스는 모든 명령과 통신을 API를 통해서 하는데 그 중심이 되는 서버가 API서버이다.  
    쿠버네티스의 모든 기능들을 REST API로 제공하고 그에 대한 명령을 처리한다.  


* ``Etcd``  

    API 서버가 명령을 주고 받는 서버라면  
    쿠버네티스 클러스터의 데이타 베이스 역할의 서버로 설정값이나 클러스터의 상태를 저장하는 서버이다.  
    etcd라는 분산형 키/밸류 스토어 오픈소스 ()https://github.com/coreos/etcd) 로  
    쿠버네티스 클러스터의 상태나 설정 정보를 저장한다.   


* ``스케쥴러``  

    스케쥴러는 Pod,서비스등 각 리소스들을 적절한 노드에 할당하는 역할을 한다.


* ``컨트롤러 매니져`` : 컨트롤러 들을 생성하고 이를 각 노드에 배포하며 이를 관리하는 역할을 한다

     * Replica controller
     * Service controller
     * Volume Controller
     * Node controller   


* ``DNS``  

    맨위의 그림에는 빠져있는데 쿠버네티스는 리소스의 엔드포인트(Endpoint)를 DNS로 맵핑하고 관리한다.  
    Pod나 서비스등은 IP를 배정받는데 동적으로 생성되는 리소스이기 때문에 그 IP 주소가 그때마다 변경이 되어  
    그 리소스에 대한 위치 정보가 필요한데 이러한 패턴을 Service discovery 패턴이라고 한다.  
    쿠버네티스에서는 이를 내부 DNS서버를 두는 방식으로 해결하였다.

    즉 새로운 리소스가 생기면 그 리소스에 대한 IP와 DNS 이름을 등록하여 DNS 이름을 기반으로 리소스에 접근할 수 있도록 한다.

<br/>

---

### 노드
    
노드는 마스터에 의해 명령을 받고 실제 워크로드를 생성하여 서비스 하는 컴포넌트이다.  
노드에는 Kubelet, Kube-proxy,cAdvisor 그리고 컨테이너 런타임이 배포된다.

* ``Kubelet``  

    노드에 배포되는 에이전트 마스터의 API서버와 통신을 하면서, 노드가 수행해야 할 명령을 받아서 수행하고  
    반대로 노드의 상태등을 마스터로 전달하는 역할을 한다. 

* ``Kube-proxy`` 

    노드로 들어오는 네트워크 트래픽을 적절한 컨테이너로 라우팅하고 로드밸런싱등  
    노드로 들어오고 나가는 네트워크 트래픽을 프록시하고 노드와 마스터간의 네트워크 통신을 관리한다. 

* ``Container runtime``  

    Pod를 통해서 배포된 컨테이너를 실행하는 컨테이너 런타임이다.  
    보통 도커 컨테이너를 생각하기 쉬운데 도커 이외에도 rkt (보안이 강화된 컨테이너), Hyper container 등 다양한 런타임이 있다.

* ``cAdvisor``  
    cAdvisor는 각 노드에서 기동되는 모니터링 에이전트이다.  
    노드내에서 가동되는 컨테이너들의 상태와 성능등의 정보를 수집하여 마스터 서버의 API 서버로 전달한다.  
    이 데이타들은 주로 모니터링을 위해서 사용된다.

---

```toc
```