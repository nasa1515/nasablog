{"componentChunkName":"component---src-templates-blog-template-js","path":"/gcp-cloudshell/","result":{"data":{"cur":{"id":"4c31f4f6-beeb-5136-85e5-ea2c0b6b62e5","html":"<p>머리말  </p>\n<p>가급적이면 모든 업무를 코드화 하고 싶었습니다.<br>\n그러기위해서 가장 기초가 되어야 하는 부분은 원격접속이라고 생각해서 포스팅합니다.</p>\n<hr>\n<h2 id=\"-google-cloud-sdk를-설치\" style=\"position:relative;\"><a href=\"#-google-cloud-sdk%EB%A5%BC-%EC%84%A4%EC%B9%98\" aria-label=\" google cloud sdk를 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✔ Google Cloud SDK를 설치</h2>\n<p><a href=\"https://cloud.google.com/sdk/docs/downloads-apt-get?hl=ko\">공식 DOC</a></p>\n<br/>\n<p>Google Cloud SDK 설치 : 이 포스트는 <code class=\"language-text\">Ubuntu 18.04 OS</code> 환경에서 진행하였습니다</p>\n<br/>\n<p>패키지 소스로 Cloud SDK 배포 URI를 추가합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">echo <span class=\"token string\">\"deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main\"</span> <span class=\"token operator\">|</span> sudo tee <span class=\"token operator\">-</span>a <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>apt<span class=\"token operator\">/</span>sources<span class=\"token punctuation\">.</span>list<span class=\"token punctuation\">.</span>d<span class=\"token operator\">/</span>google<span class=\"token operator\">-</span>cloud<span class=\"token operator\">-</span>sdk<span class=\"token punctuation\">.</span>list</code></pre></div>\n<br/>\n<br/>\n<p>설치 전 apt-transport-https 의 설치 유무를 확인합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">root@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span># sudo apt<span class=\"token operator\">-</span><span class=\"token keyword\">get</span> install apt<span class=\"token operator\">-</span>transport<span class=\"token operator\">-</span>https ca<span class=\"token operator\">-</span>certificates gnupg\n패키지 목록을 읽는 중입니다<span class=\"token range operator\">..</span><span class=\"token punctuation\">.</span> 완료\n의존성 트리를 만드는 중입니다       \n상태 정보를 읽는 중입니다<span class=\"token range operator\">..</span><span class=\"token punctuation\">.</span> 완료\n패키지 ca<span class=\"token operator\">-</span>certificates는 이미 최신 버전입니다 <span class=\"token punctuation\">(</span><span class=\"token number\">20190110</span><span class=\"token operator\">~</span><span class=\"token number\">18.04</span><span class=\"token number\">.1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>\n패키지 gnupg는 이미 최신 버전입니다 <span class=\"token punctuation\">(</span><span class=\"token number\">2.2</span><span class=\"token number\">.4</span><span class=\"token operator\">-</span>1ubuntu1<span class=\"token punctuation\">.</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>\ngnupg 패키지는 수동설치로 지정합니다<span class=\"token punctuation\">.</span>\n패키지 apt<span class=\"token operator\">-</span>transport<span class=\"token operator\">-</span>https는 이미 최신 버전입니다 <span class=\"token punctuation\">(</span><span class=\"token number\">1.6</span><span class=\"token punctuation\">.</span>12ubuntu0<span class=\"token punctuation\">.</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>\n다음 패키지가 자동으로 설치되었지만 더 이상 필요하지 않습니다<span class=\"token punctuation\">:</span>\namd64<span class=\"token operator\">-</span>microcode fonts<span class=\"token operator\">-</span>lato intel<span class=\"token operator\">-</span>microcode iucode<span class=\"token operator\">-</span>tool javascript<span class=\"token operator\">-</span>common libfwup1libgmp<span class=\"token operator\">-</span>dev\nlibgmpxx4ldbl libgsoap<span class=\"token operator\">-</span><span class=\"token number\">2.8</span><span class=\"token number\">.60</span> libjs<span class=\"token operator\">-</span>jquery libllvm9 libvncserver1linux<span class=\"token operator\">-</span>headers<span class=\"token operator\">-</span>generic<span class=\"token operator\">-</span>hwe<span class=\"token operator\">-</span><span class=\"token number\">18.04</span>\nlinux<span class=\"token operator\">-</span>hwe<span class=\"token operator\">-</span><span class=\"token number\">5.4</span><span class=\"token operator\">-</span>headers<span class=\"token operator\">-</span><span class=\"token number\">5.4</span><span class=\"token number\">.0</span><span class=\"token operator\">-</span><span class=\"token number\">42</span> ruby<span class=\"token operator\">-</span>did<span class=\"token operator\">-</span>you<span class=\"token operator\">-</span>mean ruby<span class=\"token operator\">-</span>minitest ruby<span class=\"token operator\">-</span>net<span class=\"token operator\">-</span>telnetruby<span class=\"token operator\">-</span>power<span class=\"token operator\">-</span>assert\nruby2<span class=\"token punctuation\">.</span><span class=\"token number\">5</span><span class=\"token operator\">-</span>doc rubygems<span class=\"token operator\">-</span>integration thermald ubuntu<span class=\"token operator\">-</span>fan\nUse 'sudo apt autoremove' to <span class=\"token keyword\">remove</span> them<span class=\"token punctuation\">.</span>\n<span class=\"token number\">0</span>개 업그레이드<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span>개 새로 설치<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span>개 제거 및 <span class=\"token number\">34</span>개 업그레이드 안 함<span class=\"token punctuation\">.</span></code></pre></div>\n<br/>\n<br/>\n<p>Google Cloud 공개 키를 가져옵니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token class-name\">curl</span> https<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>packages<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>apt<span class=\"token operator\">/</span>doc<span class=\"token operator\">/</span>apt<span class=\"token operator\">-</span>key<span class=\"token punctuation\">.</span>gpg <span class=\"token operator\">|</span> sudo apt<span class=\"token operator\">-</span>key <span class=\"token operator\">--</span>keyring<span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>share<span class=\"token operator\">/</span>keyrings<span class=\"token operator\">/</span>cloud<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>gpg <span class=\"token keyword\">add</span> <span class=\"token operator\">-</span>\nroot@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span># <span class=\"token class-name\">curl</span> https<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>packages<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>apt<span class=\"token operator\">/</span>doc<span class=\"token operator\">/</span>apt<span class=\"token operator\">-</span>key<span class=\"token punctuation\">.</span>gpg <span class=\"token operator\">|</span> sudoapt<span class=\"token operator\">-</span>key <span class=\"token operator\">--</span>keyring <span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>share<span class=\"token operator\">/</span>keyrings<span class=\"token operator\">/</span>cloud<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>gpg <span class=\"token keyword\">add</span> <span class=\"token operator\">-</span>\n <span class=\"token operator\">%</span> Total    <span class=\"token operator\">%</span> Received <span class=\"token operator\">%</span> Xferd  Average Speed   Time    Time     Time  Current\n                                Dload  Upload   Total   Spent    Left  Speed\n<span class=\"token number\">100</span>   <span class=\"token number\">653</span>  <span class=\"token number\">100</span>   <span class=\"token number\">653</span>    <span class=\"token number\">0</span>     <span class=\"token number\">0</span>   <span class=\"token number\">1653</span>      <span class=\"token number\">0</span> <span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span> <span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span> <span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span>  <span class=\"token number\">1653</span>\nOK</code></pre></div>\n<br/>\n<br/>\n<p>Cloud SDK를 업데이트하고 설치합니다.  </p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">root@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span># sudo apt<span class=\"token operator\">-</span><span class=\"token keyword\">get</span> update <span class=\"token operator\">&amp;&amp;</span> sudo apt<span class=\"token operator\">-</span><span class=\"token keyword\">get</span> install google<span class=\"token operator\">-</span>cloud<span class=\"token operator\">-</span>sdk</code></pre></div>\n<br/>\n<br/>\n<p>gcloud init 명령을 통해 사용합니다!</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">root@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span># gcloud init\nWelcome<span class=\"token operator\">!</span> This command will take you through the configuration of gcloud<span class=\"token punctuation\">.</span>\nYour current configuration has been <span class=\"token keyword\">set</span> to<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">]</span>\nYou can skip diagnostics next time <span class=\"token keyword\">by</span> <span class=\"token keyword\">using</span> the <span class=\"token class-name\">following</span> flag<span class=\"token punctuation\">:</span>\ngcloud init <span class=\"token operator\">--</span>skip<span class=\"token operator\">-</span>diagnostics\nNetwork diagnostic detects <span class=\"token keyword\">and</span> fixes local network connection issues<span class=\"token punctuation\">.</span>\nChecking network connection<span class=\"token range operator\">..</span>done<span class=\"token punctuation\">.</span>                                                                 \nReachability Check passed<span class=\"token punctuation\">.</span>\nNetwork <span class=\"token return-type class-name\">diagnostic</span> passed <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">/</span><span class=\"token number\">1</span> <span class=\"token class-name\">checks</span> passed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>\nYou <span class=\"token class-name\">must</span> log <span class=\"token keyword\">in</span> to <span class=\"token keyword\">continue</span><span class=\"token punctuation\">.</span> Would you like <span class=\"token class-name\">to</span> log <span class=\"token keyword\">in</span> <span class=\"token punctuation\">(</span>Y<span class=\"token operator\">/</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">?</span>  Y\n<span class=\"token range operator\">..</span><span class=\"token range operator\">..</span>\n<span class=\"token range operator\">..</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>중략<span class=\"token punctuation\">)</span></code></pre></div>\n<br/>\n<br/>\n<p>그럼 특정 계정 접속을 선택할 수 있는데 알맞게 선택합니다  </p>\n<p>계정 선택!  </p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/96085929-7c9acf80-0efc-11eb-9f5d-0e592ecf1ba9.png\" alt=\"스크린샷, 2020-10-15 15-38-30\"></p>\n<br/>\n<br/>\n<p><code class=\"language-text\">엑세스 권환 확인</code></p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/96086021-9b00cb00-0efc-11eb-95fa-10e2dea32d93.png\" alt=\"스크린샷, 2020-10-15 15-39-21\"><br>\n<code class=\"language-text\">모두 허용해주시구요</code></p>\n<br/>\n<br/>\n<p>gcloud init 명령어를 통해 기본적인 설정을 해줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">root@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span># gcloud init\nWelcome<span class=\"token operator\">!</span> This command will take you through the configuration of gcloud<span class=\"token punctuation\">.</span>\nSettings <span class=\"token keyword\">from</span> your current configuration <span class=\"token punctuation\">[</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">]</span> are<span class=\"token punctuation\">:</span>\ncompute<span class=\"token punctuation\">:</span>\nregion<span class=\"token punctuation\">:</span> asia<span class=\"token operator\">-</span><span class=\"token class-name\">northeast3</span>\nzone<span class=\"token punctuation\">:</span> asia<span class=\"token operator\">-</span>northeast3<span class=\"token operator\">-</span><span class=\"token class-name\">b</span>\ncore<span class=\"token punctuation\">:</span>\naccount<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span> 개인정보 암호화<span class=\"token operator\">!</span>\ndisable_usage_reporting<span class=\"token punctuation\">:</span> 'True'\nproject<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span> 개인정보 암호화<span class=\"token operator\">!</span>\nPick configuration <span class=\"token class-name\">to</span> use<span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> Re<span class=\"token operator\">-</span>initialize <span class=\"token keyword\">this</span> configuration <span class=\"token punctuation\">[</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">]</span> with <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">settings</span> \n<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> Create a <span class=\"token keyword\">new</span> configuration\nPlease enter your <span class=\"token class-name\">numeric</span> choice<span class=\"token punctuation\">:</span>  <span class=\"token number\">1</span></code></pre></div>\n<br/>\n<br/>\n<p>이제 Cloud Shell로 ssh 대화형 접속이 가능해집니다!</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">root@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span># gcloud alpha cloud<span class=\"token operator\">-</span>shell ssh\n'Automatic authentication with GCP <span class=\"token class-name\">CLI</span> tools <span class=\"token keyword\">in</span> Cloud Shell <span class=\"token keyword\">is</span> <span class=\"token class-name\">disabled<span class=\"token punctuation\">.</span> To</span> enable<span class=\"token punctuation\">,</span>please rerun command with `<span class=\"token operator\">--</span>authorize<span class=\"token operator\">-</span>session` flag<span class=\"token punctuation\">.</span>\nWARNING<span class=\"token punctuation\">:</span> The <span class=\"token keyword\">private</span> SSH key file <span class=\"token keyword\">for</span> gcloud does <span class=\"token keyword\">not</span> exist<span class=\"token punctuation\">.</span>\nWARNING<span class=\"token punctuation\">:</span> The <span class=\"token keyword\">public</span> SSH key file <span class=\"token keyword\">for</span> gcloud does <span class=\"token keyword\">not</span> exist<span class=\"token punctuation\">.</span>\nWARNING<span class=\"token punctuation\">:</span> You <span class=\"token keyword\">do</span> <span class=\"token keyword\">not</span> have an SSH key <span class=\"token keyword\">for</span> gcloud<span class=\"token punctuation\">.</span>\nWARNING<span class=\"token punctuation\">:</span> SSH keygen will be executed to generate a key<span class=\"token punctuation\">.</span>\nGenerating <span class=\"token keyword\">public</span><span class=\"token operator\">/</span><span class=\"token keyword\">private</span> rsa key pair<span class=\"token punctuation\">.</span>\n<span class=\"token range operator\">..</span><span class=\"token punctuation\">.</span>\n<span class=\"token range operator\">..</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>중략<span class=\"token punctuation\">)</span>\nYour Cloud <span class=\"token class-name\">Platform</span> project <span class=\"token keyword\">in</span> <span class=\"token keyword\">this</span> session <span class=\"token keyword\">is</span> <span class=\"token keyword\">set</span> to cccr<span class=\"token operator\">-</span>nov2<span class=\"token punctuation\">.</span>\nUse “gcloud config <span class=\"token keyword\">set</span> project <span class=\"token punctuation\">[</span>PROJECT_ID<span class=\"token punctuation\">]</span>” to change to a different project<span class=\"token punctuation\">.</span>\nh43254@cloudshell<span class=\"token punctuation\">:</span><span class=\"token operator\">~</span> <span class=\"token punctuation\">(</span>cccr<span class=\"token operator\">-</span>nov2<span class=\"token punctuation\">)</span>$ </code></pre></div>\n<br/>\n<hr>\n<h3 id=\"마치며\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마치며…</h3>\n<p>이제 3대 Public Cloud 중 하나인 GCP에 대한 개념을 어느 정도 잡고 있는 것 같습니다.<br>\n이번 포스트에서는 아직 운영전의 사전 설정 단계라 공식문서에도 친절하게 나와있는 부분이지만 실습과 이론은 다르다는걸 알았습니다.<br>\n공식문서에 모두 제시되어있지만 똑같이 따라한다고 해서 전부 되는건 아니였죠…  </p>\n<p>다음 포스트에는 DevSecOPs CI/CD 파이프 라인을 적용해보고 정리하는 시간을 갖도록 하겠습니다.</p>\n<hr>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-google-cloud-sdk%EB%A5%BC-%EC%84%A4%EC%B9%98\">✔ Google Cloud SDK를 설치</a></p>\n<ul>\n<li><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\">마치며…</a></li>\n</ul>\n</li>\n</ul>\n</div>","excerpt":"머리말   가급적이면 모든 업무를 코드화 하고 싶었습니다. 그러기위해서 가장 기초가 되어야 하는 부분은 원격접속이라고 생각해서 포스팅합니다. ✔ Google Cloud SDK를 설치 공식 DOC Google Cloud SDK 설치 : 이 포스트는  환경에서 진행하였습니다 패키지 소스로 Cloud SDK 배포 URI를 추가합니다. 설치 전 apt-transport-https 의 설치 유무를 확인합니다. Google Cloud 공개 키를 가져옵니다. Cloud SDK를 업데이트하고 설치합니다.   gcloud init 명령을 통해 사용합니다! 그럼 특정 계정 접속을 선택할 수 있는데 알맞게 선택합니다   계정 선택!   …","frontmatter":{"date":"August 07, 2021","title":"[GCP] - GCP Cloud shell 원격 접속 하기","categories":"GCP","author":"nasa1515","emoji":"🤦‍♂️"},"fields":{"slug":"/gcp-cloudshell/"}},"next":{"id":"85410047-efe9-5c0d-aa1f-e10ed1571e2d","html":"<p>머리말  </p>\n<p>안녕하세요 NASA입니다!!.<br>\n이번 포스트에서는 Open Source인 Gitops기반의 Argo-CD 를 이용한 배포에 대해서 포스트했습니다<br>\n앞서 다룬 포스트에서 기본적인 환경구성은 모두 완료되었고 이제부터 진정한 파이프라인 구성입니다!!</p>\n<hr>\n<ul>\n<li>사용 할 툴을 다음과 같습니다.  </li>\n<li>Rancher (GKE)</li>\n<li>Argo-cd</li>\n</ul>\n<hr>\n<h2 id=\"-환경구성\" style=\"position:relative;\"><a href=\"#-%ED%99%98%EA%B2%BD%EA%B5%AC%EC%84%B1\" aria-label=\" 환경구성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✔ 환경구성</h2>\n<ul>\n<li>환경구성의 경우 이전 포스트에서 모두 완료했습니다!!</li>\n<li>다만 클러스터 내부에 직접 들어가 Argo-CD를 설치하는게 아닌 Rancher의 카탈로그를 사용해서 자동 Helm 배포를 진행합니다</li>\n</ul>\n<hr>\n<h2 id=\"-rancher-argo-cd-plugin을-설치\" style=\"position:relative;\"><a href=\"#-rancher-argo-cd-plugin%EC%9D%84-%EC%84%A4%EC%B9%98\" aria-label=\" rancher argo cd plugin을 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✔ Rancher Argo-CD Plugin을 설치</h2>\n<p>구축중인 파이프라인의 전제적인 Service Flow는 다음과 같습니다</p>\n<ul>\n<li><code class=\"language-text\">CI : Jenkins -> DockerHUB / CD : Gitlab -> Argo-CD -> Rancher Cluseter</code>   <br>\nApi를 통한 이미지 배포 (Rolling update) 진행 및 히스토리 관리 예정.</li>\n</ul>\n<br/>\n<hr>\n<h3 id=\"작업-시작-전-정보\" style=\"position:relative;\"><a href=\"#%EC%9E%91%EC%97%85-%EC%8B%9C%EC%9E%91-%EC%A0%84-%EC%A0%95%EB%B3%B4\" aria-label=\"작업 시작 전 정보 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>작업 시작 전 정보!</h3>\n<p>— > Docker Containor Restart</p>\n<p>도커의 경우 VM과는 다르다 컨테이너란 프로세스의 개념으로 생각하면된다<br>\nGCP 인스턴스의 Docker로 실행한 Jenkins가 이로 인해 문제를 발생시켰다</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token punctuation\">[</span>root@jenkins <span class=\"token operator\">~</span><span class=\"token punctuation\">]</span># docker ps <span class=\"token operator\">-</span>a\nCONTAINER ID        IMAGE                    COMMAND                  CREATED             STATUS                      PORTS               NAMES\nd8cbbb69e267        jenkins<span class=\"token operator\">/</span>jenkins<span class=\"token punctuation\">:</span>latest   <span class=\"token string\">\"/sbin/tini -- /usr/…\"</span>   <span class=\"token number\">18</span> hours <span class=\"token return-type class-name\">ago</span>        Exited <span class=\"token punctuation\">(</span><span class=\"token number\">143</span><span class=\"token punctuation\">)</span> <span class=\"token number\">17</span> hours ago                       jenkins\n<span class=\"token punctuation\">[</span>root@jenkins <span class=\"token operator\">~</span><span class=\"token punctuation\">]</span># </code></pre></div>\n<p>이렇게 인스턴스를 재부팅하면 컨테이너가 죽는다…</p>\n<p>그럼 위의 명령어로 해당 컨테이너 아이디를 확인 후 Container restart 명령어로 되살리면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token punctuation\">[</span>root@jenkins <span class=\"token operator\">~</span><span class=\"token punctuation\">]</span># docker container restart d8cbbb69e267\nd8cbbb69e267</code></pre></div>\n<br/>\n<ul>\n<li>\n<p>Rancher 대쉬보드 -> APP -> Launch 탭에 접속</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/95819968-285be800-0d62-11eb-810c-34a4666edeac.png\" alt=\"aaaa\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>Argo-CD Plugin 검색 후 각 노드에 배포</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/95820019-47f31080-0d62-11eb-8b41-3952f785acac.png\" alt=\"스크린샷, 2020-10-13 14-42-08\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>이런 설정들은 기본으로 두어도 됩니다.</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/95820058-5e00d100-0d62-11eb-8110-10b3149c4826.png\" alt=\"스크린샷, 2020-10-13 14-42-46\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>그럼 아래와 같이 Rancher 대쉬보드에서 배포된 Apps에 대해서 확인 할 수 있습니다</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/95820133-838dda80-0d62-11eb-84d2-7ee6115b69cf.png\" alt=\"스크린샷, 2020-10-13 14-43-49\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>배포가 모두 완료된 후 ARGO-CD APPS에 들어가면 아래와 같이 Endpoint 주소를 띄웁니다.\n해당 주소로 접속!!\n<img src=\"https://user-images.githubusercontent.com/69498804/95820242-b6d06980-0d62-11eb-8bc9-5f0705adeb23.png\" alt=\"스크린샷, 2020-10-13 14-45-13\"></li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>그럼 다음과 같은 Argo-CD의 대쉬보드에 접속이 가능합니다.</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/95820317-db2c4600-0d62-11eb-8789-ef49d07cc6c6.png\" alt=\"스크린샷, 2020-10-13 14-46-16\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>하지만 관리자 PASSWORD는 서버명으로 설정되기 때문에 아래 POD에 접속합니다</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/95820435-0a42b780-0d63-11eb-8bb3-9c73de758bbd.png\" alt=\"스크린샷, 2020-10-13 14-47-33\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>아래 POD의 전체 ID가 현재 관리자(ADMIN) 계정의 패스워드입니다. 입력 후 접속!!</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/95820534-3100ee00-0d63-11eb-8460-26824e97e779.png\" alt=\"스크린샷, 2020-10-13 14-48-38\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>정상적으로 접속이 되었다면 아래와 같이 배포 파이프라인을 설정 할 수 있는 창이 나오게 됩니다.</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/95820622-5aba1500-0d63-11eb-9f27-1ac1fdc3b5d4.png\" alt=\"스크린샷, 2020-10-13 14-49-49\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>설정 -> 저장소 탭에서 연동할 GITALB의 주소를 등록해줍니다</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/95822592-2d6f6600-0d67-11eb-8e0f-da14e9b434dd.png\" alt=\"스크린샷, 2020-10-13 15-17-13\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>New APP을 눌러 새로운 파이프라인을 설정해줍니다</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/95820959-0499a180-0d64-11eb-832f-bf6a4f4fb2a8.png\" alt=\"스크린샷, 2020-10-13 14-54-35\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>그럼 아래와 같은 PipeLINE App이 하나 만들어집니다!!</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/95821114-4fb3b480-0d64-11eb-94a1-eaa4df36079a.png\" alt=\"스크린샷, 2020-10-13 14-56-40\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>GITLAB 저장소에는 아래와 같은 두 파일이 존재하고 내용을 다음과 같다</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/95821188-6fe37380-0d64-11eb-9d94-76b0837a8d56.png\" alt=\"스크린샷, 2020-10-13 14-57-33\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>deploy.yaml 예제.</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">apiVersion<span class=\"token punctuation\">:</span> apps<span class=\"token operator\">/</span><span class=\"token class-name\">v1</span>\nkind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Deployment</span>\nmetadata<span class=\"token punctuation\">:</span>\nname<span class=\"token punctuation\">:</span> nasa1515<span class=\"token operator\">-</span><span class=\"token class-name\">deploy</span>\nlabels<span class=\"token punctuation\">:</span>\n    app<span class=\"token punctuation\">:</span> nasa1515<span class=\"token operator\">-</span><span class=\"token class-name\">deploy</span>\nspec<span class=\"token punctuation\">:</span>\nreplicas<span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\nselector<span class=\"token punctuation\">:</span>\n    matchLabels<span class=\"token punctuation\">:</span>\n    app<span class=\"token punctuation\">:</span> nasa1515<span class=\"token operator\">-</span><span class=\"token class-name\">deploy</span>\ntemplate<span class=\"token punctuation\">:</span>\n    metadata<span class=\"token punctuation\">:</span>\n    labels<span class=\"token punctuation\">:</span>\n        app<span class=\"token punctuation\">:</span> nasa1515<span class=\"token operator\">-</span><span class=\"token class-name\">deploy</span>\n    spec<span class=\"token punctuation\">:</span>\n    containers<span class=\"token punctuation\">:</span>\n    <span class=\"token operator\">-</span> image<span class=\"token punctuation\">:</span> nasa1415<span class=\"token operator\">/</span>devops<span class=\"token punctuation\">:</span><span class=\"token class-name\">latest</span>\n        name<span class=\"token punctuation\">:</span> nasa1515<span class=\"token operator\">-</span><span class=\"token class-name\">app</span>\n        ports<span class=\"token punctuation\">:</span>\n        <span class=\"token operator\">-</span> containerPort<span class=\"token punctuation\">:</span> <span class=\"token number\">8000</span></code></pre></div>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>service.yaml 예제.</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">apiVersion<span class=\"token punctuation\">:</span> <span class=\"token class-name\">v1</span>\nkind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Service</span>\nmetadata<span class=\"token punctuation\">:</span>\nname<span class=\"token punctuation\">:</span> nasa1515<span class=\"token operator\">-</span><span class=\"token class-name\">svc</span>\nspec<span class=\"token punctuation\">:</span>\ntype<span class=\"token punctuation\">:</span> <span class=\"token class-name\">NodePort</span>\nports<span class=\"token punctuation\">:</span>\n<span class=\"token operator\">-</span> port<span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span>\n    targetPort<span class=\"token punctuation\">:</span> <span class=\"token number\">8000</span>\n    nodePort<span class=\"token punctuation\">:</span> <span class=\"token number\">31111</span>\nselector<span class=\"token punctuation\">:</span>\n    app<span class=\"token punctuation\">:</span> nasa1515<span class=\"token operator\">-</span>deploy</code></pre></div>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>이제 만들어둔 App에서 SYNC를 누르게 되면</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/95821383-c0f36780-0d64-11eb-8691-2538c3b7bc85.png\" alt=\"스크린샷, 2020-10-13 14-59-49\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>다음과 같이 배포파일을 읽어와 노드에 배포합니다!!</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/95823833-4547e980-0d69-11eb-842b-ea9e04341594.png\" alt=\"스크린샷, 2020-10-13 15-32-08\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>실제 Rancher에서의 로그를 보면 다음과 같이 Argo-cd에서의 배포 로그를 확인가능합니다</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/95823941-72949780-0d69-11eb-8e65-d016680a0a4e.png\" alt=\"스크린샷, 2020-10-13 15-33-22\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>추가적으로 Rancher에서 확인해보면 배포가 정상적이고 서비스 중임을 확인 가능합니다.</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/95824040-9b1c9180-0d69-11eb-9c5b-4b09b626218a.png\" alt=\"스크린샷, 2020-10-13 15-34-33\"></p>\n</li>\n</ul>\n<hr>\n<h3 id=\"마치며\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마치며…</h3>\n<p>이번 포스트에서는 Argo-CD를 설치하고 툴을 통해서 배포하는 법을 알아봤습니다.<br>\n직접 설치한 것이 아니라 Rancher의 기능을 이용해서 다른 불필요한 트러블 슈팅을 줄여서 그나마 짧게 끝난 것 같습니다.<br>\n이렇게 메니페스트 파일을 통해서 자동으로 컨테이너를 올리고 오케스트레이션 하는 것들을 직접해보니<br>\n이제서야 DevOps 엔지니어에 대해서 쌀알 만큼 알아가고 있는 것 같은 느낌입니다. </p>\n<p>다음 포스트에는 실제 취약점 검사 툴 들을 올리고 서비스, DB 연동들까지 진행하겠습니다.</p>\n<hr>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#-%ED%99%98%EA%B2%BD%EA%B5%AC%EC%84%B1\">✔ 환경구성</a></li>\n<li>\n<p><a href=\"#-rancher-argo-cd-plugin%EC%9D%84-%EC%84%A4%EC%B9%98\">✔ Rancher Argo-CD Plugin을 설치</a></p>\n<ul>\n<li><a href=\"#%EC%9E%91%EC%97%85-%EC%8B%9C%EC%9E%91-%EC%A0%84-%EC%A0%95%EB%B3%B4\">작업 시작 전 정보!</a></li>\n<li><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\">마치며…</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"August 07, 2021","title":"[DEVOPS] - Argo-CD를 이용한 배포 자동화","categories":"DevOps","author":"nasa1515","emoji":"🤦‍♂️"},"fields":{"slug":"/devops-argocd/"}},"prev":{"id":"bdbab45f-6ba1-56d5-9b14-88db8da9d77d","html":"<p>머리말  </p>\n<p>이전에 구성한 파이프라인의 전체적인 자동화는 아직 구성이 안됐지만 CI, CD 각각의 자동화는 마쳤습니다.<br>\n그렇기에 이번에는 실제 보안 취약점 검사를 위한 오픈소스 툴을 Rancher 클러스터 환경에 배포해봤습니다.!!<br>\n사용할 툴은 DVMN인데 기본적으로 PHP 배포판이 대부분이지만<br>\n저는 Jenkins에서 Junit등의 취약점 분석을 조금 더 쉽게 하기 위해서 JAVA 기반의 배포판으로 MSA를 만들어 배포했습니다.</p>\n<hr>\n<p>사용 할 툴을 다음과 같습니다.  </p>\n<ul>\n<li>GITHUB</li>\n<li>ArgoCD</li>\n<li>Helm</li>\n<li>kompose</li>\n</ul>\n<br/>\n<hr>\n<h2 id=\"-dvwa-msa-생성\" style=\"position:relative;\"><a href=\"#-dvwa-msa-%EC%83%9D%EC%84%B1\" aria-label=\" dvwa msa 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✔ DVWA MSA 생성</h2>\n<p><a href=\"https://github.com/appsecco/dvja\">DVMN JAVA 링크</a> 해당 주소에서 JAVA기반의 DVWA앱을 확인했습니다!!</p>\n<p>그러나 기본 JAVA 배포판은 Docker.compose.yaml만 존재하기 때문에<br>\n쿠버네티스에 MSP로 각각 배포할 수 있는 메니페스트를 직접 만들어줘야 했습니다.</p>\n<br/>\n<ul>\n<li>\n<p>kompose 툴 사용기  </p>\n<p>GOOGLE 서칭을 해보다가 docker.compose를 yaml 파일로 변환해주는 툴을 발견해서 사용해봤다.<br>\n자세한 사항은 <a href=\"https://github.com/kubernetes/kompose/blob/master/docs/installation.md#centos\">공식 GITHUB 확인!</a></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>kompose 설치</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">root@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>home<span class=\"token operator\">/</span>kompose# curl <span class=\"token operator\">-</span><span class=\"token class-name\">L</span> https<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>github<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>kubernetes<span class=\"token operator\">/</span>kompose<span class=\"token operator\">/</span>releases<span class=\"token operator\">/</span>download<span class=\"token operator\">/</span>v1<span class=\"token punctuation\">.</span><span class=\"token number\">22.0</span><span class=\"token operator\">/</span>kompose<span class=\"token operator\">-</span>linux<span class=\"token operator\">-</span>amd64 <span class=\"token operator\">-</span>o kompose\n<span class=\"token operator\">%</span> Total    <span class=\"token operator\">%</span> Received <span class=\"token operator\">%</span> Xferd  Average Speed   Time    Time     Time  Current\n                                Dload  Upload   Total   Spent    Left  Speed\n<span class=\"token number\">100</span>   <span class=\"token number\">643</span>  <span class=\"token number\">100</span>   <span class=\"token number\">643</span>    <span class=\"token number\">0</span>     <span class=\"token number\">0</span>   <span class=\"token number\">1391</span>      <span class=\"token number\">0</span> <span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span> <span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span> <span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span>  <span class=\"token number\">1388</span>\n<span class=\"token number\">100</span> <span class=\"token number\">23.8M</span>  <span class=\"token number\">100</span> <span class=\"token number\">23.8M</span>    <span class=\"token number\">0</span>     <span class=\"token number\">0</span>  3411k      <span class=\"token number\">0</span>  <span class=\"token number\">0</span><span class=\"token punctuation\">:</span><span class=\"token number\">00</span><span class=\"token punctuation\">:</span><span class=\"token number\">07</span>  <span class=\"token number\">0</span><span class=\"token punctuation\">:</span><span class=\"token number\">00</span><span class=\"token punctuation\">:</span><span class=\"token number\">07</span> <span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span> 4968k\nroot@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>home<span class=\"token operator\">/</span>kompose# ls \nkompose\n\nroot@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>home<span class=\"token operator\">/</span>kompose# chmod <span class=\"token operator\">+</span>x kompose\nroot@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>home<span class=\"token operator\">/</span>kompose# sudo mv <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>kompose <span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>local<span class=\"token operator\">/</span>bin<span class=\"token operator\">/</span>kompose</code></pre></div>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>DWWA의 docker.compose.yml 파일은 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">version<span class=\"token punctuation\">:</span> <span class=\"token string character\">'2'</span>\nservices<span class=\"token punctuation\">:</span>\nmysql<span class=\"token punctuation\">:</span>\n    image<span class=\"token punctuation\">:</span> mysql<span class=\"token punctuation\">:</span><span class=\"token number\">5.5</span>\n    volumes<span class=\"token punctuation\">:</span>\n    <span class=\"token operator\">-</span> mysql<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token keyword\">var</span><span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span><span class=\"token class-name\">mysql</span>\n    environment<span class=\"token punctuation\">:</span>\n    MYSQL_ROOT_PASSWORD<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ec95c258266b8e985848cae688effa2b</span>\napp<span class=\"token punctuation\">:</span>\n    build<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>\n    depends_on<span class=\"token punctuation\">:</span>\n    <span class=\"token operator\">-</span> <span class=\"token class-name\">mysql</span>\n    ports<span class=\"token punctuation\">:</span>\n    <span class=\"token operator\">-</span> <span class=\"token string\">\"8080:8080\"</span>\n    environment<span class=\"token punctuation\">:</span>\n    MYSQL_USER<span class=\"token punctuation\">:</span> <span class=\"token class-name\">root</span>\n    MYSQL_PASSWORD<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ec95c258266b8e985848cae688effa2b</span>\nvolumes<span class=\"token punctuation\">:</span>\nmysql<span class=\"token punctuation\">:</span></code></pre></div>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>위의 docker.compose.yml 파일을 kompose 변환기로 변환해보자!</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">root@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>home<span class=\"token operator\">/</span>kompose# kompose convert <span class=\"token operator\">-</span>f docker<span class=\"token operator\">-</span>compose<span class=\"token punctuation\">.</span>yaml\nWARN Unsupported root level volumes key <span class=\"token operator\">-</span> ignoring \nWARN Unsupported depends_on key <span class=\"token operator\">-</span> ignoring        \nINFO Kubernetes file <span class=\"token string\">\"app-service.yaml\"</span> created   \nINFO Kubernetes file <span class=\"token string\">\"app-deployment.yaml\"</span> created \nINFO Kubernetes file <span class=\"token string\">\"mysql-deployment.yaml\"</span> created \nINFO Kubernetes file <span class=\"token string\">\"mysql-persistentvolumeclaim.yaml\"</span> created </code></pre></div>\n<p>총 4개의 파일이 yaml 파일이 생성되었다!</p>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>간단하게 app을 배포하는 deployement yaml을 하나만 열어보자</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">apiVersion<span class=\"token punctuation\">:</span> apps<span class=\"token operator\">/</span><span class=\"token class-name\">v1</span>\nkind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Deployment</span>\nmetadata<span class=\"token punctuation\">:</span>\n    annotations<span class=\"token punctuation\">:</span>\n        kompose<span class=\"token punctuation\">.</span>cmd<span class=\"token punctuation\">:</span> kompose convert <span class=\"token operator\">-</span>f docker<span class=\"token operator\">-</span>compose<span class=\"token punctuation\">.</span>yaml\n        kompose<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">:</span> <span class=\"token number\">1.22</span><span class=\"token number\">.0</span> <span class=\"token punctuation\">(</span>955b78124<span class=\"token punctuation\">)</span>\ncreationTimestamp<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\nlabels<span class=\"token punctuation\">:</span>\n     io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">app</span>\n name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">app</span>\nspec<span class=\"token punctuation\">:</span>\n    replicas<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n     selector<span class=\"token punctuation\">:</span>\n            matchLabels<span class=\"token punctuation\">:</span>\n            io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">app</span>\n strategy<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n template<span class=\"token punctuation\">:</span>\n    metadata<span class=\"token punctuation\">:</span>\n     annotations<span class=\"token punctuation\">:</span>\n        kompose<span class=\"token punctuation\">.</span>cmd<span class=\"token punctuation\">:</span> kompose convert <span class=\"token operator\">-</span>f docker<span class=\"token operator\">-</span>compose<span class=\"token punctuation\">.</span>yaml\n        kompose<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">:</span> <span class=\"token number\">1.22</span><span class=\"token number\">.0</span> <span class=\"token punctuation\">(</span>955b78124<span class=\"token punctuation\">)</span>\n     creationTimestamp<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\n     labels<span class=\"token punctuation\">:</span>\n      io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">app</span>\n    spec<span class=\"token punctuation\">:</span>\n      containers<span class=\"token punctuation\">:</span>\n         <span class=\"token operator\">-</span> env<span class=\"token punctuation\">:</span>\n              <span class=\"token operator\">-</span> name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">MYSQL_PASSWORD</span>\n                <span class=\"token keyword\">value</span><span class=\"token punctuation\">:</span> ec95c258266b8e985848cae688effa2b\n              <span class=\"token operator\">-</span> name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">MYSQL_USER</span>\n                <span class=\"token keyword\">value</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">root</span>\n         image<span class=\"token punctuation\">:</span> <span class=\"token class-name\">app</span>\n         name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">app</span>\n        ports<span class=\"token punctuation\">:</span>\n            <span class=\"token operator\">-</span> containerPort<span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span>\n         resources<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    restartPolicy<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Always</span>\nstatus<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>위와 같이 매니페스트 파일들이 생성되어 MSA를 만드는데 조금 더 시간을 절약 할 수 있었다.</p>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>이제 k8s 클러스터에 알맞게 배포하기 위해서 메니페스트 파일들을 수정, 생성했다.</p>\n<p>ArgoCD에서 github 웹훅으로 배포하기 위해 github에 관련 메니페스트 파일들을 모두 올려놓았다.</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/98902408-0ab4a680-24f9-11eb-9e8c-aff3237409c9.png\" alt=\"스크린샷, 2020-11-12 15-09-11\"></p>\n</li>\n</ul>\n<br/>\n<hr>\n<h3 id=\"-메니페스트-하나씩-내용을-살펴보자\" style=\"position:relative;\"><a href=\"#-%EB%A9%94%EB%8B%88%ED%8E%98%EC%8A%A4%ED%8A%B8-%ED%95%98%EB%82%98%EC%94%A9-%EB%82%B4%EC%9A%A9%EC%9D%84-%EC%82%B4%ED%8E%B4%EB%B3%B4%EC%9E%90\" aria-label=\" 메니페스트 하나씩 내용을 살펴보자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✌ 메니페스트 하나씩 내용을 살펴보자.</h3>\n<p>우선 메니페스트들의 가변적으로 바뀌는 설정들을 일일히 바꾸는 작업을 간소화 하기 위해서<br>\n헬름차트 기반으로 메니페스트를 배포하기로 했다.<br>\n즉 Jenkins 서버에서는 values.yaml 파일의 이미지 tag값을 빌드 넘버로 바꾸어 배포가 되게 만든 아키텍처이다.</p>\n<br/>\n<ul>\n<li>\n<p>values.yaml </p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token preprocessor property\"># Default values for ghost.</span>\n<span class=\"token preprocessor property\"># This is a YAML-formatted file.</span>\n<span class=\"token preprocessor property\"># Declare variables to be passed into your templates.</span>\n\nreplicaCount<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n\nimage<span class=\"token punctuation\">:</span>\nrepository<span class=\"token punctuation\">:</span> jisunpark<span class=\"token operator\">/</span>cccr<span class=\"token operator\">-</span>dvwa<span class=\"token operator\">-</span>java<span class=\"token operator\">-</span><span class=\"token class-name\">web</span>\ntag<span class=\"token punctuation\">:</span> <span class=\"token number\">13</span>     <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">--</span>해당 값이 바뀌면 배포가 이루어진다<span class=\"token punctuation\">.</span>\npullPolicy<span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n\n\n<span class=\"token keyword\">value</span><span class=\"token punctuation\">:</span> ec95c258266b8e985848cae688effa2b\n\n<span class=\"token keyword\">namespace</span><span class=\"token punctuation\">:</span> cd<span class=\"token operator\">-</span><span class=\"token class-name\">test</span>\n\nname<span class=\"token punctuation\">:</span> \napp<span class=\"token punctuation\">:</span> app</code></pre></div>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>app-deployment.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">apiVersion<span class=\"token punctuation\">:</span> apps<span class=\"token operator\">/</span><span class=\"token class-name\">v1</span>\nkind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Deployment</span>\nmetadata<span class=\"token punctuation\">:</span>\nannotations<span class=\"token punctuation\">:</span>\n    kompose<span class=\"token punctuation\">.</span>cmd<span class=\"token punctuation\">:</span> kompose convert\n    kompose<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">:</span> <span class=\"token number\">1.21</span><span class=\"token number\">.0</span> <span class=\"token punctuation\">(</span>992df58d8<span class=\"token punctuation\">)</span>\ncreationTimestamp<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\nlabels<span class=\"token punctuation\">:</span>\n    io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>app <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\nname<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>app <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\nspec<span class=\"token punctuation\">:</span>\nreplicas<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span>replicaCount <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\nselector<span class=\"token punctuation\">:</span>\n    matchLabels<span class=\"token punctuation\">:</span>\n    io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>app <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\nstrategy<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\ntemplate<span class=\"token punctuation\">:</span>\n    metadata<span class=\"token punctuation\">:</span>\n    annotations<span class=\"token punctuation\">:</span>\n        kompose<span class=\"token punctuation\">.</span>cmd<span class=\"token punctuation\">:</span> kompose convert\n        kompose<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">:</span> <span class=\"token number\">1.21</span><span class=\"token number\">.0</span> <span class=\"token punctuation\">(</span>992df58d8<span class=\"token punctuation\">)</span>\n    creationTimestamp<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\n    labels<span class=\"token punctuation\">:</span>\n        io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>app <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    spec<span class=\"token punctuation\">:</span>\n    containers<span class=\"token punctuation\">:</span>\n    <span class=\"token operator\">-</span> env<span class=\"token punctuation\">:</span>\n        <span class=\"token operator\">-</span> name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">MYSQL_PASSWORD</span>\n        <span class=\"token keyword\">value</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span><span class=\"token keyword\">value</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">-</span> name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">MYSQL_USER</span>\n        <span class=\"token keyword\">value</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">root</span>\n        image<span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ .Values.image.repository }}:{{ .Values.image.tag }}\"</span>\n        imagePullPolicy<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span>image<span class=\"token punctuation\">.</span>pullPolicy <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        name<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>app <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        ports<span class=\"token punctuation\">:</span>\n        <span class=\"token operator\">-</span> containerPort<span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span>\n        resources<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    restartPolicy<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Always</span>\n    serviceAccountName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    volumes<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\nstatus<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>간단하게 설명하면 Jenkins 에서 수정하고 빌드한 DVWA 이미지의 빌드넘버를 받아와 배포한다.</p>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>app-service.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">apiVersion<span class=\"token punctuation\">:</span> <span class=\"token class-name\">v1</span>\nkind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Service</span>\nmetadata<span class=\"token punctuation\">:</span>\nannotations<span class=\"token punctuation\">:</span>\n    cloud<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>neg<span class=\"token punctuation\">:</span> '<span class=\"token punctuation\">{</span><span class=\"token string\">\"ingress\"</span><span class=\"token punctuation\">:</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span>'\n    field<span class=\"token punctuation\">.</span>cattle<span class=\"token punctuation\">.</span>io<span class=\"token operator\">/</span>publicEndpoints<span class=\"token punctuation\">:</span> '<span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"addresses\"</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"35.223.27.28\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"port\"</span><span class=\"token punctuation\">:</span><span class=\"token number\">8080</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"protocol\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"TCP\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"serviceName\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"cd-test:app\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"allNodes\"</span><span class=\"token punctuation\">:</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>'\n    kompose<span class=\"token punctuation\">.</span>cmd<span class=\"token punctuation\">:</span> kompose convert\n    kompose<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">:</span> <span class=\"token number\">1.21</span><span class=\"token number\">.0</span> <span class=\"token punctuation\">(</span>992df58d8<span class=\"token punctuation\">)</span>\nlabels<span class=\"token punctuation\">:</span>\n    io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>app <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\nname<span class=\"token punctuation\">:</span> app<span class=\"token operator\">-</span>lb\n<span class=\"token keyword\">namespace</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span><span class=\"token keyword\">namespace</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\nspec<span class=\"token punctuation\">:</span>\nexternalTrafficPolicy<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Cluster</span>\nports<span class=\"token punctuation\">:</span>\n<span class=\"token operator\">-</span> name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"8080\"</span>\n    port<span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span>\n    protocol<span class=\"token punctuation\">:</span> <span class=\"token class-name\">TCP</span>\n    targetPort<span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span>\nselector<span class=\"token punctuation\">:</span>\n    io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>app <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\nsessionAffinity<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ClientIP</span>\ntype<span class=\"token punctuation\">:</span> <span class=\"token class-name\">LoadBalancer</span>\nloadBalancerIP<span class=\"token punctuation\">:</span> <span class=\"token number\">35.223</span><span class=\"token number\">.27</span><span class=\"token number\">.28</span></code></pre></div>\n<p>GCP에서 서비스 하다보니 LBIP를 임의로 지정해주어서 서비스를 설정했다.<br>\n이 부분은 이후의 포스트에서 자세하게 설명한다.</p>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>mysql-deployment.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">apiVersion<span class=\"token punctuation\">:</span> apps<span class=\"token operator\">/</span><span class=\"token class-name\">v1</span>\nkind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Deployment</span>\nmetadata<span class=\"token punctuation\">:</span>\nannotations<span class=\"token punctuation\">:</span>\n    kompose<span class=\"token punctuation\">.</span>cmd<span class=\"token punctuation\">:</span> kompose convert\n    kompose<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">:</span> <span class=\"token number\">1.21</span><span class=\"token number\">.0</span> <span class=\"token punctuation\">(</span>992df58d8<span class=\"token punctuation\">)</span>\ncreationTimestamp<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\nlabels<span class=\"token punctuation\">:</span>\n    io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\nname<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\nspec<span class=\"token punctuation\">:</span>\nreplicas<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\nselector<span class=\"token punctuation\">:</span>\n    matchLabels<span class=\"token punctuation\">:</span>\n    io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\nstrategy<span class=\"token punctuation\">:</span>\n    type<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Recreate</span>\ntemplate<span class=\"token punctuation\">:</span>\n    metadata<span class=\"token punctuation\">:</span>\n    annotations<span class=\"token punctuation\">:</span>\n        kompose<span class=\"token punctuation\">.</span>cmd<span class=\"token punctuation\">:</span> kompose convert\n        kompose<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">:</span> <span class=\"token number\">1.21</span><span class=\"token number\">.0</span> <span class=\"token punctuation\">(</span>992df58d8<span class=\"token punctuation\">)</span>\n    creationTimestamp<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\n    labels<span class=\"token punctuation\">:</span>\n        io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\n    spec<span class=\"token punctuation\">:</span>\n    containers<span class=\"token punctuation\">:</span>\n    <span class=\"token operator\">-</span> env<span class=\"token punctuation\">:</span>\n        <span class=\"token operator\">-</span> name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">MYSQL_ROOT_PASSWORD</span>\n        <span class=\"token keyword\">value</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">ec95c258266b8e985848cae688effa2b</span>\n        image<span class=\"token punctuation\">:</span> mysql<span class=\"token punctuation\">:</span><span class=\"token number\">5.5</span>\n        imagePullPolicy<span class=\"token punctuation\">:</span> <span class=\"token class-name\">IfNotPresent</span>\n        name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\n        resources<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n        volumeMounts<span class=\"token punctuation\">:</span>\n        <span class=\"token operator\">-</span> mountPath<span class=\"token punctuation\">:</span> <span class=\"token operator\">/</span><span class=\"token keyword\">var</span><span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span><span class=\"token class-name\">mysql</span>\n        name<span class=\"token punctuation\">:</span> mysql<span class=\"token operator\">-</span><span class=\"token class-name\">vol</span>\n    restartPolicy<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Always</span>\n    serviceAccountName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    volumes<span class=\"token punctuation\">:</span>\n    <span class=\"token operator\">-</span> name<span class=\"token punctuation\">:</span> mysql<span class=\"token operator\">-</span><span class=\"token class-name\">vol</span>\n        persistentVolumeClaim<span class=\"token punctuation\">:</span>\n        claimName<span class=\"token punctuation\">:</span> mysql<span class=\"token operator\">-</span><span class=\"token class-name\">pvc</span>\nstatus<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>mysql-service.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">apiVersion<span class=\"token punctuation\">:</span> <span class=\"token class-name\">v1</span>\nkind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Service</span>\nmetadata<span class=\"token punctuation\">:</span>\nannotations<span class=\"token punctuation\">:</span>\n    kompose<span class=\"token punctuation\">.</span>cmd<span class=\"token punctuation\">:</span> kompose convert\n    kompose<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">:</span> <span class=\"token number\">1.21</span><span class=\"token number\">.0</span> <span class=\"token punctuation\">(</span>992df58d8<span class=\"token punctuation\">)</span>\ncreationTimestamp<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\nlabels<span class=\"token punctuation\">:</span>\n    io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\nname<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\nspec<span class=\"token punctuation\">:</span>\nports<span class=\"token punctuation\">:</span>\n<span class=\"token operator\">-</span> name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"3306\"</span>\n    port<span class=\"token punctuation\">:</span> <span class=\"token number\">3306</span>\n    targetPort<span class=\"token punctuation\">:</span> <span class=\"token number\">3306</span>\nselector<span class=\"token punctuation\">:</span>\n    io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> mysql</code></pre></div>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>mysql-pvc.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">apiVersion<span class=\"token punctuation\">:</span> <span class=\"token class-name\">v1</span>\nkind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">PersistentVolumeClaim</span>\nmetadata<span class=\"token punctuation\">:</span>\ncreationTimestamp<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\nlabels<span class=\"token punctuation\">:</span>\n    io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\nname<span class=\"token punctuation\">:</span> mysql<span class=\"token operator\">-</span>pvc\n<span class=\"token keyword\">namespace</span><span class=\"token punctuation\">:</span> cd<span class=\"token operator\">-</span><span class=\"token class-name\">test</span>\nspec<span class=\"token punctuation\">:</span>\naccessModes<span class=\"token punctuation\">:</span>\n<span class=\"token operator\">-</span> <span class=\"token class-name\">ReadWriteMany</span>\nstorageClassName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\nvolumeName<span class=\"token punctuation\">:</span> <span class=\"token class-name\">dbserver</span>\nresources<span class=\"token punctuation\">:</span>\n    requests<span class=\"token punctuation\">:</span>\n    storage<span class=\"token punctuation\">:</span> 5Gi\nstatus<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>GCP의 FILE STORE를 사용해서 PVC를 만들었다<br>\n이 부분에서는 다음 포스트에서 자세하게 설명되어있다.</p>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>mysql-pv-nfscreate.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">apiVersion<span class=\"token punctuation\">:</span> <span class=\"token class-name\">v1</span>\nkind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">PersistentVolume</span>\nmetadata<span class=\"token punctuation\">:</span>\nname<span class=\"token punctuation\">:</span> dbserver\n<span class=\"token keyword\">namespace</span><span class=\"token punctuation\">:</span> cd<span class=\"token operator\">-</span><span class=\"token class-name\">test</span>\nspec<span class=\"token punctuation\">:</span>\ncapacity<span class=\"token punctuation\">:</span>\n    storage<span class=\"token punctuation\">:</span> 10Gi\nvolumeMode<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Filesystem</span>\naccessModes<span class=\"token punctuation\">:</span>\n    <span class=\"token operator\">-</span> <span class=\"token class-name\">ReadWriteMany</span>\npersistentVolumeReclaimPolicy<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Retain</span>\nstorageClassName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\nnfs<span class=\"token punctuation\">:</span>\n    path<span class=\"token punctuation\">:</span> <span class=\"token operator\">/</span><span class=\"token class-name\">nfs_share</span>\n    server<span class=\"token punctuation\">:</span> <span class=\"token number\">10.254</span><span class=\"token number\">.194</span><span class=\"token number\">.122</span></code></pre></div>\n<p>PV의 생성 또한 다음포스트에서 다룬다.</p>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>namespace.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">kind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Namespace</span>\napiVersion<span class=\"token punctuation\">:</span> <span class=\"token class-name\">v1</span>\nmetadata<span class=\"token punctuation\">:</span>\nannotations<span class=\"token punctuation\">:</span>\n    field<span class=\"token punctuation\">.</span>cattle<span class=\"token punctuation\">.</span>io<span class=\"token operator\">/</span>projectId<span class=\"token punctuation\">:</span> c<span class=\"token operator\">-</span>dcn6h<span class=\"token punctuation\">:</span>p<span class=\"token operator\">-</span>8scft\nname<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span><span class=\"token keyword\">namespace</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\nlabels<span class=\"token punctuation\">:</span>\n    name<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span><span class=\"token keyword\">namespace</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    field<span class=\"token punctuation\">.</span>cattle<span class=\"token punctuation\">.</span>io<span class=\"token operator\">/</span>projectId<span class=\"token punctuation\">:</span> p<span class=\"token operator\">-</span>8scft</code></pre></div>\n<p>간단한 앱 배포를 위한 네임스페이스를 생성하는 매니페스트 파일이다.</p>\n</li>\n</ul>\n<br/>\n<hr>\n<p>결론적으로 GITHUB에 헬름 저장소를 넣어둔 뒤 해당 저장소의 값이 바뀌면<br>\nArgo-CD 가 SYNC를 맞춰주면서 배포를 하는 프로세스입니다..</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/98903444-f376b880-24fa-11eb-9042-094db9247577.png\" alt=\"스크린샷, 2020-11-12 15-22-57\"></p>\n<ul>\n<li><a href=\"https://github.com/nasa1515/cccr-dvwa-helm\">저장소 링크</a></li>\n</ul>\n<br/>\n<hr>\n<h3 id=\"마치며\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마치며…</h3>\n<p>실제로 매니페스트를 일일히 수정하고 생성하면 k8s에 대한 개념들을 다시 잡은 것 같습니다.<br>\n이번 포스트에서 드디어 간단한 파이프라인 자동화를 마칠 수 있었고 보람찬 포스트였습니다.<br>\n약간의 아쉬움이 드는 것은 GCP가 아닌 AWS, AZURE로 했으면 어땠을까 하는 아쉬움이 남습니다.<br>\n생각보다 GCP에서 지원해주는 기능들이 원만하게 사용되지 않는 경우가 많아서…</p>\n<hr>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-dvwa-msa-%EC%83%9D%EC%84%B1\">✔ DVWA MSA 생성</a></p>\n<ul>\n<li><a href=\"#-%EB%A9%94%EB%8B%88%ED%8E%98%EC%8A%A4%ED%8A%B8-%ED%95%98%EB%82%98%EC%94%A9-%EB%82%B4%EC%9A%A9%EC%9D%84-%EC%82%B4%ED%8E%B4%EB%B3%B4%EC%9E%90\">✌ 메니페스트 하나씩 내용을 살펴보자.</a></li>\n<li><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\">마치며…</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"August 07, 2021","title":"[DEVOPS] - 보안 취약점 검사를 위한 Dvmn 앱 자동 배포하기","categories":"DevOps","author":"nasa1515","emoji":"🤦‍♂️"},"fields":{"slug":"/devops-cicd2/"}},"site":{"siteMetadata":{"siteUrl":"https://nasa1515.com","comments":{"utterances":{"repo":"nasa1515/nasablog"}}}}},"pageContext":{"slug":"/gcp-cloudshell/","nextSlug":"/devops-argocd/","prevSlug":"/devops-cicd2/"}},"staticQueryHashes":["1073350324","2938748437"]}