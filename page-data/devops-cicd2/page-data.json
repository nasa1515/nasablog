{"componentChunkName":"component---src-templates-blog-template-js","path":"/devops-cicd2/","result":{"data":{"cur":{"id":"bdbab45f-6ba1-56d5-9b14-88db8da9d77d","html":"<p>머리말  </p>\n<p>이전에 구성한 파이프라인의 전체적인 자동화는 아직 구성이 안됐지만 CI, CD 각각의 자동화는 마쳤습니다.<br>\n그렇기에 이번에는 실제 보안 취약점 검사를 위한 오픈소스 툴을 Rancher 클러스터 환경에 배포해봤습니다.!!<br>\n사용할 툴은 DVMN인데 기본적으로 PHP 배포판이 대부분이지만<br>\n저는 Jenkins에서 Junit등의 취약점 분석을 조금 더 쉽게 하기 위해서 JAVA 기반의 배포판으로 MSA를 만들어 배포했습니다.</p>\n<hr>\n<p>사용 할 툴을 다음과 같습니다.  </p>\n<ul>\n<li>GITHUB</li>\n<li>ArgoCD</li>\n<li>Helm</li>\n<li>kompose</li>\n</ul>\n<br/>\n<hr>\n<h2 id=\"-dvwa-msa-생성\" style=\"position:relative;\"><a href=\"#-dvwa-msa-%EC%83%9D%EC%84%B1\" aria-label=\" dvwa msa 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✔ DVWA MSA 생성</h2>\n<p><a href=\"https://github.com/appsecco/dvja\">DVMN JAVA 링크</a> 해당 주소에서 JAVA기반의 DVWA앱을 확인했습니다!!</p>\n<p>그러나 기본 JAVA 배포판은 Docker.compose.yaml만 존재하기 때문에<br>\n쿠버네티스에 MSP로 각각 배포할 수 있는 메니페스트를 직접 만들어줘야 했습니다.</p>\n<br/>\n<ul>\n<li>\n<p>kompose 툴 사용기  </p>\n<p>GOOGLE 서칭을 해보다가 docker.compose를 yaml 파일로 변환해주는 툴을 발견해서 사용해봤다.<br>\n자세한 사항은 <a href=\"https://github.com/kubernetes/kompose/blob/master/docs/installation.md#centos\">공식 GITHUB 확인!</a></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>kompose 설치</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">root@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>home<span class=\"token operator\">/</span>kompose# curl <span class=\"token operator\">-</span><span class=\"token class-name\">L</span> https<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>github<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>kubernetes<span class=\"token operator\">/</span>kompose<span class=\"token operator\">/</span>releases<span class=\"token operator\">/</span>download<span class=\"token operator\">/</span>v1<span class=\"token punctuation\">.</span><span class=\"token number\">22.0</span><span class=\"token operator\">/</span>kompose<span class=\"token operator\">-</span>linux<span class=\"token operator\">-</span>amd64 <span class=\"token operator\">-</span>o kompose\n<span class=\"token operator\">%</span> Total    <span class=\"token operator\">%</span> Received <span class=\"token operator\">%</span> Xferd  Average Speed   Time    Time     Time  Current\n                                Dload  Upload   Total   Spent    Left  Speed\n<span class=\"token number\">100</span>   <span class=\"token number\">643</span>  <span class=\"token number\">100</span>   <span class=\"token number\">643</span>    <span class=\"token number\">0</span>     <span class=\"token number\">0</span>   <span class=\"token number\">1391</span>      <span class=\"token number\">0</span> <span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span> <span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span> <span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span>  <span class=\"token number\">1388</span>\n<span class=\"token number\">100</span> <span class=\"token number\">23.8M</span>  <span class=\"token number\">100</span> <span class=\"token number\">23.8M</span>    <span class=\"token number\">0</span>     <span class=\"token number\">0</span>  3411k      <span class=\"token number\">0</span>  <span class=\"token number\">0</span><span class=\"token punctuation\">:</span><span class=\"token number\">00</span><span class=\"token punctuation\">:</span><span class=\"token number\">07</span>  <span class=\"token number\">0</span><span class=\"token punctuation\">:</span><span class=\"token number\">00</span><span class=\"token punctuation\">:</span><span class=\"token number\">07</span> <span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span> 4968k\nroot@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>home<span class=\"token operator\">/</span>kompose# ls \nkompose\n\nroot@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>home<span class=\"token operator\">/</span>kompose# chmod <span class=\"token operator\">+</span>x kompose\nroot@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>home<span class=\"token operator\">/</span>kompose# sudo mv <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>kompose <span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>local<span class=\"token operator\">/</span>bin<span class=\"token operator\">/</span>kompose</code></pre></div>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>DWWA의 docker.compose.yml 파일은 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">version<span class=\"token punctuation\">:</span> <span class=\"token string character\">'2'</span>\nservices<span class=\"token punctuation\">:</span>\nmysql<span class=\"token punctuation\">:</span>\n    image<span class=\"token punctuation\">:</span> mysql<span class=\"token punctuation\">:</span><span class=\"token number\">5.5</span>\n    volumes<span class=\"token punctuation\">:</span>\n    <span class=\"token operator\">-</span> mysql<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token keyword\">var</span><span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span><span class=\"token class-name\">mysql</span>\n    environment<span class=\"token punctuation\">:</span>\n    MYSQL_ROOT_PASSWORD<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ec95c258266b8e985848cae688effa2b</span>\napp<span class=\"token punctuation\">:</span>\n    build<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>\n    depends_on<span class=\"token punctuation\">:</span>\n    <span class=\"token operator\">-</span> <span class=\"token class-name\">mysql</span>\n    ports<span class=\"token punctuation\">:</span>\n    <span class=\"token operator\">-</span> <span class=\"token string\">\"8080:8080\"</span>\n    environment<span class=\"token punctuation\">:</span>\n    MYSQL_USER<span class=\"token punctuation\">:</span> <span class=\"token class-name\">root</span>\n    MYSQL_PASSWORD<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ec95c258266b8e985848cae688effa2b</span>\nvolumes<span class=\"token punctuation\">:</span>\nmysql<span class=\"token punctuation\">:</span></code></pre></div>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>위의 docker.compose.yml 파일을 kompose 변환기로 변환해보자!</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">root@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>home<span class=\"token operator\">/</span>kompose# kompose convert <span class=\"token operator\">-</span>f docker<span class=\"token operator\">-</span>compose<span class=\"token punctuation\">.</span>yaml\nWARN Unsupported root level volumes key <span class=\"token operator\">-</span> ignoring \nWARN Unsupported depends_on key <span class=\"token operator\">-</span> ignoring        \nINFO Kubernetes file <span class=\"token string\">\"app-service.yaml\"</span> created   \nINFO Kubernetes file <span class=\"token string\">\"app-deployment.yaml\"</span> created \nINFO Kubernetes file <span class=\"token string\">\"mysql-deployment.yaml\"</span> created \nINFO Kubernetes file <span class=\"token string\">\"mysql-persistentvolumeclaim.yaml\"</span> created </code></pre></div>\n<p>총 4개의 파일이 yaml 파일이 생성되었다!</p>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>간단하게 app을 배포하는 deployement yaml을 하나만 열어보자</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">apiVersion<span class=\"token punctuation\">:</span> apps<span class=\"token operator\">/</span><span class=\"token class-name\">v1</span>\nkind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Deployment</span>\nmetadata<span class=\"token punctuation\">:</span>\n    annotations<span class=\"token punctuation\">:</span>\n        kompose<span class=\"token punctuation\">.</span>cmd<span class=\"token punctuation\">:</span> kompose convert <span class=\"token operator\">-</span>f docker<span class=\"token operator\">-</span>compose<span class=\"token punctuation\">.</span>yaml\n        kompose<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">:</span> <span class=\"token number\">1.22</span><span class=\"token number\">.0</span> <span class=\"token punctuation\">(</span>955b78124<span class=\"token punctuation\">)</span>\ncreationTimestamp<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\nlabels<span class=\"token punctuation\">:</span>\n     io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">app</span>\n name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">app</span>\nspec<span class=\"token punctuation\">:</span>\n    replicas<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n     selector<span class=\"token punctuation\">:</span>\n            matchLabels<span class=\"token punctuation\">:</span>\n            io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">app</span>\n strategy<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n template<span class=\"token punctuation\">:</span>\n    metadata<span class=\"token punctuation\">:</span>\n     annotations<span class=\"token punctuation\">:</span>\n        kompose<span class=\"token punctuation\">.</span>cmd<span class=\"token punctuation\">:</span> kompose convert <span class=\"token operator\">-</span>f docker<span class=\"token operator\">-</span>compose<span class=\"token punctuation\">.</span>yaml\n        kompose<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">:</span> <span class=\"token number\">1.22</span><span class=\"token number\">.0</span> <span class=\"token punctuation\">(</span>955b78124<span class=\"token punctuation\">)</span>\n     creationTimestamp<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\n     labels<span class=\"token punctuation\">:</span>\n      io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">app</span>\n    spec<span class=\"token punctuation\">:</span>\n      containers<span class=\"token punctuation\">:</span>\n         <span class=\"token operator\">-</span> env<span class=\"token punctuation\">:</span>\n              <span class=\"token operator\">-</span> name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">MYSQL_PASSWORD</span>\n                <span class=\"token keyword\">value</span><span class=\"token punctuation\">:</span> ec95c258266b8e985848cae688effa2b\n              <span class=\"token operator\">-</span> name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">MYSQL_USER</span>\n                <span class=\"token keyword\">value</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">root</span>\n         image<span class=\"token punctuation\">:</span> <span class=\"token class-name\">app</span>\n         name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">app</span>\n        ports<span class=\"token punctuation\">:</span>\n            <span class=\"token operator\">-</span> containerPort<span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span>\n         resources<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    restartPolicy<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Always</span>\nstatus<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>위와 같이 매니페스트 파일들이 생성되어 MSA를 만드는데 조금 더 시간을 절약 할 수 있었다.</p>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>이제 k8s 클러스터에 알맞게 배포하기 위해서 메니페스트 파일들을 수정, 생성했다.</p>\n<p>ArgoCD에서 github 웹훅으로 배포하기 위해 github에 관련 메니페스트 파일들을 모두 올려놓았다.</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/98902408-0ab4a680-24f9-11eb-9e8c-aff3237409c9.png\" alt=\"스크린샷, 2020-11-12 15-09-11\"></p>\n</li>\n</ul>\n<br/>\n<hr>\n<h3 id=\"-메니페스트-하나씩-내용을-살펴보자\" style=\"position:relative;\"><a href=\"#-%EB%A9%94%EB%8B%88%ED%8E%98%EC%8A%A4%ED%8A%B8-%ED%95%98%EB%82%98%EC%94%A9-%EB%82%B4%EC%9A%A9%EC%9D%84-%EC%82%B4%ED%8E%B4%EB%B3%B4%EC%9E%90\" aria-label=\" 메니페스트 하나씩 내용을 살펴보자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✌ 메니페스트 하나씩 내용을 살펴보자.</h3>\n<p>우선 메니페스트들의 가변적으로 바뀌는 설정들을 일일히 바꾸는 작업을 간소화 하기 위해서<br>\n헬름차트 기반으로 메니페스트를 배포하기로 했다.<br>\n즉 Jenkins 서버에서는 values.yaml 파일의 이미지 tag값을 빌드 넘버로 바꾸어 배포가 되게 만든 아키텍처이다.</p>\n<br/>\n<ul>\n<li>\n<p>values.yaml </p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token preprocessor property\"># Default values for ghost.</span>\n<span class=\"token preprocessor property\"># This is a YAML-formatted file.</span>\n<span class=\"token preprocessor property\"># Declare variables to be passed into your templates.</span>\n\nreplicaCount<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n\nimage<span class=\"token punctuation\">:</span>\nrepository<span class=\"token punctuation\">:</span> jisunpark<span class=\"token operator\">/</span>cccr<span class=\"token operator\">-</span>dvwa<span class=\"token operator\">-</span>java<span class=\"token operator\">-</span><span class=\"token class-name\">web</span>\ntag<span class=\"token punctuation\">:</span> <span class=\"token number\">13</span>     <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">--</span>해당 값이 바뀌면 배포가 이루어진다<span class=\"token punctuation\">.</span>\npullPolicy<span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n\n\n<span class=\"token keyword\">value</span><span class=\"token punctuation\">:</span> ec95c258266b8e985848cae688effa2b\n\n<span class=\"token keyword\">namespace</span><span class=\"token punctuation\">:</span> cd<span class=\"token operator\">-</span><span class=\"token class-name\">test</span>\n\nname<span class=\"token punctuation\">:</span> \napp<span class=\"token punctuation\">:</span> app</code></pre></div>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>app-deployment.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">apiVersion<span class=\"token punctuation\">:</span> apps<span class=\"token operator\">/</span><span class=\"token class-name\">v1</span>\nkind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Deployment</span>\nmetadata<span class=\"token punctuation\">:</span>\nannotations<span class=\"token punctuation\">:</span>\n    kompose<span class=\"token punctuation\">.</span>cmd<span class=\"token punctuation\">:</span> kompose convert\n    kompose<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">:</span> <span class=\"token number\">1.21</span><span class=\"token number\">.0</span> <span class=\"token punctuation\">(</span>992df58d8<span class=\"token punctuation\">)</span>\ncreationTimestamp<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\nlabels<span class=\"token punctuation\">:</span>\n    io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>app <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\nname<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>app <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\nspec<span class=\"token punctuation\">:</span>\nreplicas<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span>replicaCount <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\nselector<span class=\"token punctuation\">:</span>\n    matchLabels<span class=\"token punctuation\">:</span>\n    io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>app <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\nstrategy<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\ntemplate<span class=\"token punctuation\">:</span>\n    metadata<span class=\"token punctuation\">:</span>\n    annotations<span class=\"token punctuation\">:</span>\n        kompose<span class=\"token punctuation\">.</span>cmd<span class=\"token punctuation\">:</span> kompose convert\n        kompose<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">:</span> <span class=\"token number\">1.21</span><span class=\"token number\">.0</span> <span class=\"token punctuation\">(</span>992df58d8<span class=\"token punctuation\">)</span>\n    creationTimestamp<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\n    labels<span class=\"token punctuation\">:</span>\n        io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>app <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    spec<span class=\"token punctuation\">:</span>\n    containers<span class=\"token punctuation\">:</span>\n    <span class=\"token operator\">-</span> env<span class=\"token punctuation\">:</span>\n        <span class=\"token operator\">-</span> name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">MYSQL_PASSWORD</span>\n        <span class=\"token keyword\">value</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span><span class=\"token keyword\">value</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">-</span> name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">MYSQL_USER</span>\n        <span class=\"token keyword\">value</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">root</span>\n        image<span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ .Values.image.repository }}:{{ .Values.image.tag }}\"</span>\n        imagePullPolicy<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span>image<span class=\"token punctuation\">.</span>pullPolicy <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        name<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>app <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        ports<span class=\"token punctuation\">:</span>\n        <span class=\"token operator\">-</span> containerPort<span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span>\n        resources<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    restartPolicy<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Always</span>\n    serviceAccountName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    volumes<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\nstatus<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>간단하게 설명하면 Jenkins 에서 수정하고 빌드한 DVWA 이미지의 빌드넘버를 받아와 배포한다.</p>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>app-service.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">apiVersion<span class=\"token punctuation\">:</span> <span class=\"token class-name\">v1</span>\nkind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Service</span>\nmetadata<span class=\"token punctuation\">:</span>\nannotations<span class=\"token punctuation\">:</span>\n    cloud<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>neg<span class=\"token punctuation\">:</span> '<span class=\"token punctuation\">{</span><span class=\"token string\">\"ingress\"</span><span class=\"token punctuation\">:</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span>'\n    field<span class=\"token punctuation\">.</span>cattle<span class=\"token punctuation\">.</span>io<span class=\"token operator\">/</span>publicEndpoints<span class=\"token punctuation\">:</span> '<span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"addresses\"</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"35.223.27.28\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"port\"</span><span class=\"token punctuation\">:</span><span class=\"token number\">8080</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"protocol\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"TCP\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"serviceName\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"cd-test:app\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"allNodes\"</span><span class=\"token punctuation\">:</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>'\n    kompose<span class=\"token punctuation\">.</span>cmd<span class=\"token punctuation\">:</span> kompose convert\n    kompose<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">:</span> <span class=\"token number\">1.21</span><span class=\"token number\">.0</span> <span class=\"token punctuation\">(</span>992df58d8<span class=\"token punctuation\">)</span>\nlabels<span class=\"token punctuation\">:</span>\n    io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>app <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\nname<span class=\"token punctuation\">:</span> app<span class=\"token operator\">-</span>lb\n<span class=\"token keyword\">namespace</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span><span class=\"token keyword\">namespace</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\nspec<span class=\"token punctuation\">:</span>\nexternalTrafficPolicy<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Cluster</span>\nports<span class=\"token punctuation\">:</span>\n<span class=\"token operator\">-</span> name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"8080\"</span>\n    port<span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span>\n    protocol<span class=\"token punctuation\">:</span> <span class=\"token class-name\">TCP</span>\n    targetPort<span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span>\nselector<span class=\"token punctuation\">:</span>\n    io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>app <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\nsessionAffinity<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ClientIP</span>\ntype<span class=\"token punctuation\">:</span> <span class=\"token class-name\">LoadBalancer</span>\nloadBalancerIP<span class=\"token punctuation\">:</span> <span class=\"token number\">35.223</span><span class=\"token number\">.27</span><span class=\"token number\">.28</span></code></pre></div>\n<p>GCP에서 서비스 하다보니 LBIP를 임의로 지정해주어서 서비스를 설정했다.<br>\n이 부분은 이후의 포스트에서 자세하게 설명한다.</p>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>mysql-deployment.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">apiVersion<span class=\"token punctuation\">:</span> apps<span class=\"token operator\">/</span><span class=\"token class-name\">v1</span>\nkind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Deployment</span>\nmetadata<span class=\"token punctuation\">:</span>\nannotations<span class=\"token punctuation\">:</span>\n    kompose<span class=\"token punctuation\">.</span>cmd<span class=\"token punctuation\">:</span> kompose convert\n    kompose<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">:</span> <span class=\"token number\">1.21</span><span class=\"token number\">.0</span> <span class=\"token punctuation\">(</span>992df58d8<span class=\"token punctuation\">)</span>\ncreationTimestamp<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\nlabels<span class=\"token punctuation\">:</span>\n    io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\nname<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\nspec<span class=\"token punctuation\">:</span>\nreplicas<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\nselector<span class=\"token punctuation\">:</span>\n    matchLabels<span class=\"token punctuation\">:</span>\n    io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\nstrategy<span class=\"token punctuation\">:</span>\n    type<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Recreate</span>\ntemplate<span class=\"token punctuation\">:</span>\n    metadata<span class=\"token punctuation\">:</span>\n    annotations<span class=\"token punctuation\">:</span>\n        kompose<span class=\"token punctuation\">.</span>cmd<span class=\"token punctuation\">:</span> kompose convert\n        kompose<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">:</span> <span class=\"token number\">1.21</span><span class=\"token number\">.0</span> <span class=\"token punctuation\">(</span>992df58d8<span class=\"token punctuation\">)</span>\n    creationTimestamp<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\n    labels<span class=\"token punctuation\">:</span>\n        io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\n    spec<span class=\"token punctuation\">:</span>\n    containers<span class=\"token punctuation\">:</span>\n    <span class=\"token operator\">-</span> env<span class=\"token punctuation\">:</span>\n        <span class=\"token operator\">-</span> name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">MYSQL_ROOT_PASSWORD</span>\n        <span class=\"token keyword\">value</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">ec95c258266b8e985848cae688effa2b</span>\n        image<span class=\"token punctuation\">:</span> mysql<span class=\"token punctuation\">:</span><span class=\"token number\">5.5</span>\n        imagePullPolicy<span class=\"token punctuation\">:</span> <span class=\"token class-name\">IfNotPresent</span>\n        name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\n        resources<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n        volumeMounts<span class=\"token punctuation\">:</span>\n        <span class=\"token operator\">-</span> mountPath<span class=\"token punctuation\">:</span> <span class=\"token operator\">/</span><span class=\"token keyword\">var</span><span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span><span class=\"token class-name\">mysql</span>\n        name<span class=\"token punctuation\">:</span> mysql<span class=\"token operator\">-</span><span class=\"token class-name\">vol</span>\n    restartPolicy<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Always</span>\n    serviceAccountName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    volumes<span class=\"token punctuation\">:</span>\n    <span class=\"token operator\">-</span> name<span class=\"token punctuation\">:</span> mysql<span class=\"token operator\">-</span><span class=\"token class-name\">vol</span>\n        persistentVolumeClaim<span class=\"token punctuation\">:</span>\n        claimName<span class=\"token punctuation\">:</span> mysql<span class=\"token operator\">-</span><span class=\"token class-name\">pvc</span>\nstatus<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>mysql-service.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">apiVersion<span class=\"token punctuation\">:</span> <span class=\"token class-name\">v1</span>\nkind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Service</span>\nmetadata<span class=\"token punctuation\">:</span>\nannotations<span class=\"token punctuation\">:</span>\n    kompose<span class=\"token punctuation\">.</span>cmd<span class=\"token punctuation\">:</span> kompose convert\n    kompose<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">:</span> <span class=\"token number\">1.21</span><span class=\"token number\">.0</span> <span class=\"token punctuation\">(</span>992df58d8<span class=\"token punctuation\">)</span>\ncreationTimestamp<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\nlabels<span class=\"token punctuation\">:</span>\n    io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\nname<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\nspec<span class=\"token punctuation\">:</span>\nports<span class=\"token punctuation\">:</span>\n<span class=\"token operator\">-</span> name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"3306\"</span>\n    port<span class=\"token punctuation\">:</span> <span class=\"token number\">3306</span>\n    targetPort<span class=\"token punctuation\">:</span> <span class=\"token number\">3306</span>\nselector<span class=\"token punctuation\">:</span>\n    io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> mysql</code></pre></div>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>mysql-pvc.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">apiVersion<span class=\"token punctuation\">:</span> <span class=\"token class-name\">v1</span>\nkind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">PersistentVolumeClaim</span>\nmetadata<span class=\"token punctuation\">:</span>\ncreationTimestamp<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\nlabels<span class=\"token punctuation\">:</span>\n    io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\nname<span class=\"token punctuation\">:</span> mysql<span class=\"token operator\">-</span>pvc\n<span class=\"token keyword\">namespace</span><span class=\"token punctuation\">:</span> cd<span class=\"token operator\">-</span><span class=\"token class-name\">test</span>\nspec<span class=\"token punctuation\">:</span>\naccessModes<span class=\"token punctuation\">:</span>\n<span class=\"token operator\">-</span> <span class=\"token class-name\">ReadWriteMany</span>\nstorageClassName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\nvolumeName<span class=\"token punctuation\">:</span> <span class=\"token class-name\">dbserver</span>\nresources<span class=\"token punctuation\">:</span>\n    requests<span class=\"token punctuation\">:</span>\n    storage<span class=\"token punctuation\">:</span> 5Gi\nstatus<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>GCP의 FILE STORE를 사용해서 PVC를 만들었다<br>\n이 부분에서는 다음 포스트에서 자세하게 설명되어있다.</p>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>mysql-pv-nfscreate.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">apiVersion<span class=\"token punctuation\">:</span> <span class=\"token class-name\">v1</span>\nkind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">PersistentVolume</span>\nmetadata<span class=\"token punctuation\">:</span>\nname<span class=\"token punctuation\">:</span> dbserver\n<span class=\"token keyword\">namespace</span><span class=\"token punctuation\">:</span> cd<span class=\"token operator\">-</span><span class=\"token class-name\">test</span>\nspec<span class=\"token punctuation\">:</span>\ncapacity<span class=\"token punctuation\">:</span>\n    storage<span class=\"token punctuation\">:</span> 10Gi\nvolumeMode<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Filesystem</span>\naccessModes<span class=\"token punctuation\">:</span>\n    <span class=\"token operator\">-</span> <span class=\"token class-name\">ReadWriteMany</span>\npersistentVolumeReclaimPolicy<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Retain</span>\nstorageClassName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\nnfs<span class=\"token punctuation\">:</span>\n    path<span class=\"token punctuation\">:</span> <span class=\"token operator\">/</span><span class=\"token class-name\">nfs_share</span>\n    server<span class=\"token punctuation\">:</span> <span class=\"token number\">10.254</span><span class=\"token number\">.194</span><span class=\"token number\">.122</span></code></pre></div>\n<p>PV의 생성 또한 다음포스트에서 다룬다.</p>\n</li>\n</ul>\n<br/>\n<br/>\n<ul>\n<li>\n<p>namespace.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">kind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Namespace</span>\napiVersion<span class=\"token punctuation\">:</span> <span class=\"token class-name\">v1</span>\nmetadata<span class=\"token punctuation\">:</span>\nannotations<span class=\"token punctuation\">:</span>\n    field<span class=\"token punctuation\">.</span>cattle<span class=\"token punctuation\">.</span>io<span class=\"token operator\">/</span>projectId<span class=\"token punctuation\">:</span> c<span class=\"token operator\">-</span>dcn6h<span class=\"token punctuation\">:</span>p<span class=\"token operator\">-</span>8scft\nname<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span><span class=\"token keyword\">namespace</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\nlabels<span class=\"token punctuation\">:</span>\n    name<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">.</span><span class=\"token keyword\">namespace</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    field<span class=\"token punctuation\">.</span>cattle<span class=\"token punctuation\">.</span>io<span class=\"token operator\">/</span>projectId<span class=\"token punctuation\">:</span> p<span class=\"token operator\">-</span>8scft</code></pre></div>\n<p>간단한 앱 배포를 위한 네임스페이스를 생성하는 매니페스트 파일이다.</p>\n</li>\n</ul>\n<br/>\n<hr>\n<p>결론적으로 GITHUB에 헬름 저장소를 넣어둔 뒤 해당 저장소의 값이 바뀌면<br>\nArgo-CD 가 SYNC를 맞춰주면서 배포를 하는 프로세스입니다..</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/98903444-f376b880-24fa-11eb-9042-094db9247577.png\" alt=\"스크린샷, 2020-11-12 15-22-57\"></p>\n<ul>\n<li><a href=\"https://github.com/nasa1515/cccr-dvwa-helm\">저장소 링크</a></li>\n</ul>\n<br/>\n<hr>\n<h3 id=\"마치며\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마치며…</h3>\n<p>실제로 매니페스트를 일일히 수정하고 생성하면 k8s에 대한 개념들을 다시 잡은 것 같습니다.<br>\n이번 포스트에서 드디어 간단한 파이프라인 자동화를 마칠 수 있었고 보람찬 포스트였습니다.<br>\n약간의 아쉬움이 드는 것은 GCP가 아닌 AWS, AZURE로 했으면 어땠을까 하는 아쉬움이 남습니다.<br>\n생각보다 GCP에서 지원해주는 기능들이 원만하게 사용되지 않는 경우가 많아서…</p>\n<hr>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-dvwa-msa-%EC%83%9D%EC%84%B1\">✔ DVWA MSA 생성</a></p>\n<ul>\n<li><a href=\"#-%EB%A9%94%EB%8B%88%ED%8E%98%EC%8A%A4%ED%8A%B8-%ED%95%98%EB%82%98%EC%94%A9-%EB%82%B4%EC%9A%A9%EC%9D%84-%EC%82%B4%ED%8E%B4%EB%B3%B4%EC%9E%90\">✌ 메니페스트 하나씩 내용을 살펴보자.</a></li>\n<li><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\">마치며…</a></li>\n</ul>\n</li>\n</ul>\n</div>","excerpt":"머리말   이전에 구성한 파이프라인의 전체적인 자동화는 아직 구성이 안됐지만 CI, CD 각각의 자동화는 마쳤습니다. 그렇기에 이번에는 실제 보안 취약점 검사를 위한 오픈소스 툴을 Rancher 클러스터 환경에 배포해봤습니다.!! 사용할 툴은 DVMN인데 기본적으로 PHP 배포판이 대부분이지만 저는 Jenkins에서 Junit등의 취약점 분석을 조금 더 쉽게 하기 위해서 JAVA 기반의 배포판으로 MSA를 만들어 배포했습니다. 사용 할 툴을 다음과 같습니다.   GITHUB ArgoCD Helm kompose ✔ DVWA MSA 생성 DVMN JAVA 링크 해당 주소에서 JAVA기반의 DVWA앱을 확인했습니다!! 그러…","frontmatter":{"date":"August 07, 2021","title":"[DEVOPS] - 보안 취약점 검사를 위한 Dvmn 앱 자동 배포하기","categories":"DevOps","author":"nasa1515","emoji":"🤦‍♂️"},"fields":{"slug":"/devops-cicd2/"}},"next":{"id":"4c31f4f6-beeb-5136-85e5-ea2c0b6b62e5","html":"<p>머리말  </p>\n<p>가급적이면 모든 업무를 코드화 하고 싶었습니다.<br>\n그러기위해서 가장 기초가 되어야 하는 부분은 원격접속이라고 생각해서 포스팅합니다.</p>\n<hr>\n<h2 id=\"-google-cloud-sdk를-설치\" style=\"position:relative;\"><a href=\"#-google-cloud-sdk%EB%A5%BC-%EC%84%A4%EC%B9%98\" aria-label=\" google cloud sdk를 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✔ Google Cloud SDK를 설치</h2>\n<p><a href=\"https://cloud.google.com/sdk/docs/downloads-apt-get?hl=ko\">공식 DOC</a></p>\n<br/>\n<p>Google Cloud SDK 설치 : 이 포스트는 <code class=\"language-text\">Ubuntu 18.04 OS</code> 환경에서 진행하였습니다</p>\n<br/>\n<p>패키지 소스로 Cloud SDK 배포 URI를 추가합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">echo <span class=\"token string\">\"deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main\"</span> <span class=\"token operator\">|</span> sudo tee <span class=\"token operator\">-</span>a <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>apt<span class=\"token operator\">/</span>sources<span class=\"token punctuation\">.</span>list<span class=\"token punctuation\">.</span>d<span class=\"token operator\">/</span>google<span class=\"token operator\">-</span>cloud<span class=\"token operator\">-</span>sdk<span class=\"token punctuation\">.</span>list</code></pre></div>\n<br/>\n<br/>\n<p>설치 전 apt-transport-https 의 설치 유무를 확인합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">root@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span># sudo apt<span class=\"token operator\">-</span><span class=\"token keyword\">get</span> install apt<span class=\"token operator\">-</span>transport<span class=\"token operator\">-</span>https ca<span class=\"token operator\">-</span>certificates gnupg\n패키지 목록을 읽는 중입니다<span class=\"token range operator\">..</span><span class=\"token punctuation\">.</span> 완료\n의존성 트리를 만드는 중입니다       \n상태 정보를 읽는 중입니다<span class=\"token range operator\">..</span><span class=\"token punctuation\">.</span> 완료\n패키지 ca<span class=\"token operator\">-</span>certificates는 이미 최신 버전입니다 <span class=\"token punctuation\">(</span><span class=\"token number\">20190110</span><span class=\"token operator\">~</span><span class=\"token number\">18.04</span><span class=\"token number\">.1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>\n패키지 gnupg는 이미 최신 버전입니다 <span class=\"token punctuation\">(</span><span class=\"token number\">2.2</span><span class=\"token number\">.4</span><span class=\"token operator\">-</span>1ubuntu1<span class=\"token punctuation\">.</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>\ngnupg 패키지는 수동설치로 지정합니다<span class=\"token punctuation\">.</span>\n패키지 apt<span class=\"token operator\">-</span>transport<span class=\"token operator\">-</span>https는 이미 최신 버전입니다 <span class=\"token punctuation\">(</span><span class=\"token number\">1.6</span><span class=\"token punctuation\">.</span>12ubuntu0<span class=\"token punctuation\">.</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>\n다음 패키지가 자동으로 설치되었지만 더 이상 필요하지 않습니다<span class=\"token punctuation\">:</span>\namd64<span class=\"token operator\">-</span>microcode fonts<span class=\"token operator\">-</span>lato intel<span class=\"token operator\">-</span>microcode iucode<span class=\"token operator\">-</span>tool javascript<span class=\"token operator\">-</span>common libfwup1libgmp<span class=\"token operator\">-</span>dev\nlibgmpxx4ldbl libgsoap<span class=\"token operator\">-</span><span class=\"token number\">2.8</span><span class=\"token number\">.60</span> libjs<span class=\"token operator\">-</span>jquery libllvm9 libvncserver1linux<span class=\"token operator\">-</span>headers<span class=\"token operator\">-</span>generic<span class=\"token operator\">-</span>hwe<span class=\"token operator\">-</span><span class=\"token number\">18.04</span>\nlinux<span class=\"token operator\">-</span>hwe<span class=\"token operator\">-</span><span class=\"token number\">5.4</span><span class=\"token operator\">-</span>headers<span class=\"token operator\">-</span><span class=\"token number\">5.4</span><span class=\"token number\">.0</span><span class=\"token operator\">-</span><span class=\"token number\">42</span> ruby<span class=\"token operator\">-</span>did<span class=\"token operator\">-</span>you<span class=\"token operator\">-</span>mean ruby<span class=\"token operator\">-</span>minitest ruby<span class=\"token operator\">-</span>net<span class=\"token operator\">-</span>telnetruby<span class=\"token operator\">-</span>power<span class=\"token operator\">-</span>assert\nruby2<span class=\"token punctuation\">.</span><span class=\"token number\">5</span><span class=\"token operator\">-</span>doc rubygems<span class=\"token operator\">-</span>integration thermald ubuntu<span class=\"token operator\">-</span>fan\nUse 'sudo apt autoremove' to <span class=\"token keyword\">remove</span> them<span class=\"token punctuation\">.</span>\n<span class=\"token number\">0</span>개 업그레이드<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span>개 새로 설치<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span>개 제거 및 <span class=\"token number\">34</span>개 업그레이드 안 함<span class=\"token punctuation\">.</span></code></pre></div>\n<br/>\n<br/>\n<p>Google Cloud 공개 키를 가져옵니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token class-name\">curl</span> https<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>packages<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>apt<span class=\"token operator\">/</span>doc<span class=\"token operator\">/</span>apt<span class=\"token operator\">-</span>key<span class=\"token punctuation\">.</span>gpg <span class=\"token operator\">|</span> sudo apt<span class=\"token operator\">-</span>key <span class=\"token operator\">--</span>keyring<span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>share<span class=\"token operator\">/</span>keyrings<span class=\"token operator\">/</span>cloud<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>gpg <span class=\"token keyword\">add</span> <span class=\"token operator\">-</span>\nroot@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span># <span class=\"token class-name\">curl</span> https<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>packages<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>apt<span class=\"token operator\">/</span>doc<span class=\"token operator\">/</span>apt<span class=\"token operator\">-</span>key<span class=\"token punctuation\">.</span>gpg <span class=\"token operator\">|</span> sudoapt<span class=\"token operator\">-</span>key <span class=\"token operator\">--</span>keyring <span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>share<span class=\"token operator\">/</span>keyrings<span class=\"token operator\">/</span>cloud<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>gpg <span class=\"token keyword\">add</span> <span class=\"token operator\">-</span>\n <span class=\"token operator\">%</span> Total    <span class=\"token operator\">%</span> Received <span class=\"token operator\">%</span> Xferd  Average Speed   Time    Time     Time  Current\n                                Dload  Upload   Total   Spent    Left  Speed\n<span class=\"token number\">100</span>   <span class=\"token number\">653</span>  <span class=\"token number\">100</span>   <span class=\"token number\">653</span>    <span class=\"token number\">0</span>     <span class=\"token number\">0</span>   <span class=\"token number\">1653</span>      <span class=\"token number\">0</span> <span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span> <span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span> <span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span><span class=\"token punctuation\">:</span><span class=\"token operator\">--</span>  <span class=\"token number\">1653</span>\nOK</code></pre></div>\n<br/>\n<br/>\n<p>Cloud SDK를 업데이트하고 설치합니다.  </p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">root@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span># sudo apt<span class=\"token operator\">-</span><span class=\"token keyword\">get</span> update <span class=\"token operator\">&amp;&amp;</span> sudo apt<span class=\"token operator\">-</span><span class=\"token keyword\">get</span> install google<span class=\"token operator\">-</span>cloud<span class=\"token operator\">-</span>sdk</code></pre></div>\n<br/>\n<br/>\n<p>gcloud init 명령을 통해 사용합니다!</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">root@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span># gcloud init\nWelcome<span class=\"token operator\">!</span> This command will take you through the configuration of gcloud<span class=\"token punctuation\">.</span>\nYour current configuration has been <span class=\"token keyword\">set</span> to<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">]</span>\nYou can skip diagnostics next time <span class=\"token keyword\">by</span> <span class=\"token keyword\">using</span> the <span class=\"token class-name\">following</span> flag<span class=\"token punctuation\">:</span>\ngcloud init <span class=\"token operator\">--</span>skip<span class=\"token operator\">-</span>diagnostics\nNetwork diagnostic detects <span class=\"token keyword\">and</span> fixes local network connection issues<span class=\"token punctuation\">.</span>\nChecking network connection<span class=\"token range operator\">..</span>done<span class=\"token punctuation\">.</span>                                                                 \nReachability Check passed<span class=\"token punctuation\">.</span>\nNetwork <span class=\"token return-type class-name\">diagnostic</span> passed <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">/</span><span class=\"token number\">1</span> <span class=\"token class-name\">checks</span> passed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>\nYou <span class=\"token class-name\">must</span> log <span class=\"token keyword\">in</span> to <span class=\"token keyword\">continue</span><span class=\"token punctuation\">.</span> Would you like <span class=\"token class-name\">to</span> log <span class=\"token keyword\">in</span> <span class=\"token punctuation\">(</span>Y<span class=\"token operator\">/</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">?</span>  Y\n<span class=\"token range operator\">..</span><span class=\"token range operator\">..</span>\n<span class=\"token range operator\">..</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>중략<span class=\"token punctuation\">)</span></code></pre></div>\n<br/>\n<br/>\n<p>그럼 특정 계정 접속을 선택할 수 있는데 알맞게 선택합니다  </p>\n<p>계정 선택!  </p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/96085929-7c9acf80-0efc-11eb-9f5d-0e592ecf1ba9.png\" alt=\"스크린샷, 2020-10-15 15-38-30\"></p>\n<br/>\n<br/>\n<p><code class=\"language-text\">엑세스 권환 확인</code></p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/96086021-9b00cb00-0efc-11eb-95fa-10e2dea32d93.png\" alt=\"스크린샷, 2020-10-15 15-39-21\"><br>\n<code class=\"language-text\">모두 허용해주시구요</code></p>\n<br/>\n<br/>\n<p>gcloud init 명령어를 통해 기본적인 설정을 해줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">root@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span># gcloud init\nWelcome<span class=\"token operator\">!</span> This command will take you through the configuration of gcloud<span class=\"token punctuation\">.</span>\nSettings <span class=\"token keyword\">from</span> your current configuration <span class=\"token punctuation\">[</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">]</span> are<span class=\"token punctuation\">:</span>\ncompute<span class=\"token punctuation\">:</span>\nregion<span class=\"token punctuation\">:</span> asia<span class=\"token operator\">-</span><span class=\"token class-name\">northeast3</span>\nzone<span class=\"token punctuation\">:</span> asia<span class=\"token operator\">-</span>northeast3<span class=\"token operator\">-</span><span class=\"token class-name\">b</span>\ncore<span class=\"token punctuation\">:</span>\naccount<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span> 개인정보 암호화<span class=\"token operator\">!</span>\ndisable_usage_reporting<span class=\"token punctuation\">:</span> 'True'\nproject<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span> 개인정보 암호화<span class=\"token operator\">!</span>\nPick configuration <span class=\"token class-name\">to</span> use<span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> Re<span class=\"token operator\">-</span>initialize <span class=\"token keyword\">this</span> configuration <span class=\"token punctuation\">[</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">]</span> with <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">settings</span> \n<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> Create a <span class=\"token keyword\">new</span> configuration\nPlease enter your <span class=\"token class-name\">numeric</span> choice<span class=\"token punctuation\">:</span>  <span class=\"token number\">1</span></code></pre></div>\n<br/>\n<br/>\n<p>이제 Cloud Shell로 ssh 대화형 접속이 가능해집니다!</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">root@cccr<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span># gcloud alpha cloud<span class=\"token operator\">-</span>shell ssh\n'Automatic authentication with GCP <span class=\"token class-name\">CLI</span> tools <span class=\"token keyword\">in</span> Cloud Shell <span class=\"token keyword\">is</span> <span class=\"token class-name\">disabled<span class=\"token punctuation\">.</span> To</span> enable<span class=\"token punctuation\">,</span>please rerun command with `<span class=\"token operator\">--</span>authorize<span class=\"token operator\">-</span>session` flag<span class=\"token punctuation\">.</span>\nWARNING<span class=\"token punctuation\">:</span> The <span class=\"token keyword\">private</span> SSH key file <span class=\"token keyword\">for</span> gcloud does <span class=\"token keyword\">not</span> exist<span class=\"token punctuation\">.</span>\nWARNING<span class=\"token punctuation\">:</span> The <span class=\"token keyword\">public</span> SSH key file <span class=\"token keyword\">for</span> gcloud does <span class=\"token keyword\">not</span> exist<span class=\"token punctuation\">.</span>\nWARNING<span class=\"token punctuation\">:</span> You <span class=\"token keyword\">do</span> <span class=\"token keyword\">not</span> have an SSH key <span class=\"token keyword\">for</span> gcloud<span class=\"token punctuation\">.</span>\nWARNING<span class=\"token punctuation\">:</span> SSH keygen will be executed to generate a key<span class=\"token punctuation\">.</span>\nGenerating <span class=\"token keyword\">public</span><span class=\"token operator\">/</span><span class=\"token keyword\">private</span> rsa key pair<span class=\"token punctuation\">.</span>\n<span class=\"token range operator\">..</span><span class=\"token punctuation\">.</span>\n<span class=\"token range operator\">..</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>중략<span class=\"token punctuation\">)</span>\nYour Cloud <span class=\"token class-name\">Platform</span> project <span class=\"token keyword\">in</span> <span class=\"token keyword\">this</span> session <span class=\"token keyword\">is</span> <span class=\"token keyword\">set</span> to cccr<span class=\"token operator\">-</span>nov2<span class=\"token punctuation\">.</span>\nUse “gcloud config <span class=\"token keyword\">set</span> project <span class=\"token punctuation\">[</span>PROJECT_ID<span class=\"token punctuation\">]</span>” to change to a different project<span class=\"token punctuation\">.</span>\nh43254@cloudshell<span class=\"token punctuation\">:</span><span class=\"token operator\">~</span> <span class=\"token punctuation\">(</span>cccr<span class=\"token operator\">-</span>nov2<span class=\"token punctuation\">)</span>$ </code></pre></div>\n<br/>\n<hr>\n<h3 id=\"마치며\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마치며…</h3>\n<p>이제 3대 Public Cloud 중 하나인 GCP에 대한 개념을 어느 정도 잡고 있는 것 같습니다.<br>\n이번 포스트에서는 아직 운영전의 사전 설정 단계라 공식문서에도 친절하게 나와있는 부분이지만 실습과 이론은 다르다는걸 알았습니다.<br>\n공식문서에 모두 제시되어있지만 똑같이 따라한다고 해서 전부 되는건 아니였죠…  </p>\n<p>다음 포스트에는 DevSecOPs CI/CD 파이프 라인을 적용해보고 정리하는 시간을 갖도록 하겠습니다.</p>\n<hr>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-google-cloud-sdk%EB%A5%BC-%EC%84%A4%EC%B9%98\">✔ Google Cloud SDK를 설치</a></p>\n<ul>\n<li><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\">마치며…</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"August 07, 2021","title":"[GCP] - GCP Cloud shell 원격 접속 하기","categories":"CLOUD","author":"nasa1515","emoji":"🤦‍♂️"},"fields":{"slug":"/gcp-cloudshell/"}},"prev":{"id":"801845e2-ac0a-5de8-bf0a-12fd8d8036e2","html":"<p>머리말  </p>\n<p>이번 포스트에서는 앱 구동을 위한 MYSQL 이중화입니다 이전 포스트에서 앱 배포를 완료했지만<br>\nMYSQL pod의 경우 볼륨의 문제로 하나밖에 뜨지 않아 DB 데이터를 어떻게 저장할지에 대한 고민이 있었습니다.<br>\n고민해본 결과 NFS를 만들어서 그쪽에 데이터를 저장해놓고 POD가 실행될때마다 NFS를 읽어오자! 라는 결론이 나왔습니다<br>\n그래서 NFS 서버를 구축하려고 하려는 찰나 GCP에서 API 서비스로 제공한다는 소식을 듣고 바로 사용해 보았습니다</p>\n<hr>\n<ul>\n<li>\n<p>사용 할 툴을 다음과 같습니다.  </p>\n<ul>\n<li>GCP FileStore</li>\n<li>k8s PV,PVC</li>\n<li>ArgoCD</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"-발생-이슈\" style=\"position:relative;\"><a href=\"#-%EB%B0%9C%EC%83%9D-%EC%9D%B4%EC%8A%88\" aria-label=\" 발생 이슈 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✔ 발생 이슈</h2>\n<ul>\n<li>\n<p>MYSQL Pod를 두개 이상 띄우려고 할때 아래와 같은 문제가 발생했다.  </p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/96840929-11b24100-1486-11eb-9157-145a7d03bf00.png\" alt=\"스크린샷, 2020-10-22 16-45-58\"></p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">FailedAttachVolume\nMulti<span class=\"token operator\">-</span>Attach error <span class=\"token keyword\">for</span> volume <span class=\"token string\">\"pvc-73526617-313f-46f4-be6f-0776dcf151d3\"</span> Volume <span class=\"token keyword\">is</span> <span class=\"token class-name\">already</span> used <span class=\"token keyword\">by</span> <span class=\"token function\">pod</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> mysql<span class=\"token operator\">-</span><span class=\"token number\">6749799856</span><span class=\"token operator\">-</span>kb9mp\t<span class=\"token number\">6</span> minutes ago</code></pre></div>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>이유는 Google Persistent Disk의 경우 Block 스토리지의 Access Mode인 <code class=\"language-text\">ReadWriteMany</code> 옵션을 지원하지 않았습니다.</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/96841616-f6940100-1486-11eb-8b22-406d019bcf8b.png\" alt=\"스크린샷, 2020-10-22 16-52-21\"></p>\n<p>그래서 GKE를 만들때 자동 생성되는 스토리지 클래스를 사용하지 않고 PV를 직접 만들어 연결해줘야 하는 상황이 되었습니다</p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>다행히 공식문서를 보니 GCP에서 NFS(Filestore)를 PV로 지원한다는 문서를 확인해서 NFS를 사용하기로 했습니다</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/96841887-4f639980-1487-11eb-9578-307b7b86267d.png\" alt=\"스크린샷, 2020-10-22 16-54-43\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>GCP에서는 기본적으로 Standard 형의 스토리지 클래스를 지원합니다</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/96842565-268fd400-1488-11eb-9d64-66a4b1fd41db.png\" alt=\"스크린샷, 2020-10-22 17-00-52\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p><a href=\"https://kubernetes.io/ko/docs/concepts/storage/storage-classes/\">쿠버네티스 공식문서</a></p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">스토리지클래스는 관리자가 제공하는 스토리지의 <span class=\"token string\">\"classes\"</span>를 설명할 수 있는 방법을 제공한다<span class=\"token punctuation\">.</span> \n다른 클래스는 서비스의 품질 수준 또는 백업 정책<span class=\"token punctuation\">,</span> 클러스터 관리자가 정한 임의의 정책에 매핑될 수 있다<span class=\"token punctuation\">.</span> \n쿠버네티스 자체는 클래스가 무엇을 나타내는지에 대해 상관하지 않는다<span class=\"token punctuation\">.</span> \n다른 스토리지 시스템에서는 이 개념을 <span class=\"token string\">\"프로파일\"</span>이라고도 한다<span class=\"token punctuation\">.</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">스토리지클래스 리소스 \n각 스토리지클래스에는 해당 스토리지클래스에 속하는 퍼시스턴트볼륨을 동적으로 프로비저닝 할 때 사용되는 provisioner<span class=\"token punctuation\">,</span> parameters 와 reclaimPolicy 필드가 포함된다<span class=\"token punctuation\">.</span>\n\n스토리지클래스 오브젝트의 이름은 중요하며<span class=\"token punctuation\">,</span> 사용자가 특정 클래스를 요청할 수 있는 방법이다<span class=\"token punctuation\">.</span> \n관리자는 스토리지클래스 오브젝트를 처음 생성할 때 클래스의 이름과 기타 파라미터를 설정하며<span class=\"token punctuation\">,</span> 일단 생성된 오브젝트는 업데이트할 수 없다<span class=\"token punctuation\">.</span>\n\n관리자는 특정 클래스에 바인딩을 요청하지 않는 PVC에 대해서만 기본 스토리지클래스를 지정할 수 있다<span class=\"token punctuation\">.</span> </code></pre></div>\n<br/>\n<ul>\n<li>쿠버네티스에서는 아래와 같이 정의 할 수 있다</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">apiVersion<span class=\"token punctuation\">:</span> storage<span class=\"token punctuation\">.</span>k8s<span class=\"token punctuation\">.</span>io<span class=\"token operator\">/</span><span class=\"token class-name\">v1</span>\nkind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">StorageClass</span>\n  metadata<span class=\"token punctuation\">:</span>\n  name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">standard</span>\n    provisioner<span class=\"token punctuation\">:</span> kubernetes<span class=\"token punctuation\">.</span>io<span class=\"token operator\">/</span>aws<span class=\"token operator\">-</span><span class=\"token class-name\">ebs</span>\n  parameters<span class=\"token punctuation\">:</span>\n  type<span class=\"token punctuation\">:</span> <span class=\"token class-name\">gp2</span>\n  reclaimPolicy<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Retain</span>\n  allowVolumeExpansion<span class=\"token punctuation\">:</span> <span class=\"token class-name\">true</span>\n  mountOptions<span class=\"token punctuation\">:</span>\n   <span class=\"token operator\">-</span> <span class=\"token class-name\">debug</span>\n  volumeBindingMode<span class=\"token punctuation\">:</span> Immediate</code></pre></div>\n<ul>\n<li>즉 간단하게 말해서 PV를 미리 선언해주는 것이라고 이해하는게 편하다.</li>\n<li>보통 PV 선언 -> PVC 선언의 과정을 거쳐야 하지만 스토리지 클래스를 미리 정의해놓으면 PV선언 과정을 생략할 수 있다.</li>\n</ul>\n</li>\n</ul>\n<br/>\n<hr>\n<h2 id=\"-이제-gcp의-nfsfilestore를-구성해보죠\" style=\"position:relative;\"><a href=\"#-%EC%9D%B4%EC%A0%9C-gcp%EC%9D%98-nfsfilestore%EB%A5%BC-%EA%B5%AC%EC%84%B1%ED%95%B4%EB%B3%B4%EC%A3%A0\" aria-label=\" 이제 gcp의 nfsfilestore를 구성해보죠 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✌ 이제 GCP의 NFS(Filestore)를 구성해보죠</h2>\n<br/>\n<h3 id=\"gcp-nfs-설정\" style=\"position:relative;\"><a href=\"#gcp-nfs-%EC%84%A4%EC%A0%95\" aria-label=\"gcp nfs 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>GCP NFS 설정</h3>\n<br/>\n<ul>\n<li>\n<p>우선 GCP Console에서 FILEStore API를 설치해줍니다</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/96854037-0404b780-1496-11eb-81c4-922d294a441d.png\" alt=\"스크린샷, 2020-10-22 18-39-50\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>그 후 Console TAP의 Filestore 메뉴에서 인스턴스를 생성해줍니다</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/96854705-c3f20480-1496-11eb-89dc-3a46f4b99df6.png\" alt=\"스크린샷, 2020-10-22 18-45-28\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>생성이 완료되었다면 자동으로 NFS가 연동됩니다. 임시로 Jenkins 인스턴스에서 Showmount 명령으로 확인해봅시다</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token punctuation\">[</span>root@jenkins <span class=\"token operator\">~</span><span class=\"token punctuation\">]</span># \n<span class=\"token punctuation\">[</span>root@jenkins <span class=\"token operator\">~</span><span class=\"token punctuation\">]</span># showmount <span class=\"token operator\">-</span>e <span class=\"token number\">10.254</span><span class=\"token number\">.194</span><span class=\"token number\">.122</span>\nExport list <span class=\"token keyword\">for</span> <span class=\"token number\">10.254</span><span class=\"token number\">.194</span><span class=\"token number\">.122</span><span class=\"token punctuation\">:</span>\n<span class=\"token operator\">/</span>nfs_share <span class=\"token number\">192.168</span><span class=\"token number\">.0</span><span class=\"token number\">.0</span><span class=\"token operator\">/</span><span class=\"token number\">16</span><span class=\"token punctuation\">,</span><span class=\"token number\">172.16</span><span class=\"token number\">.0</span><span class=\"token number\">.0</span><span class=\"token operator\">/</span><span class=\"token number\">12</span><span class=\"token punctuation\">,</span><span class=\"token number\">10.0</span><span class=\"token number\">.0</span><span class=\"token number\">.0</span><span class=\"token operator\">/</span><span class=\"token number\">8</span>\n<span class=\"token punctuation\">[</span>root@jenkins <span class=\"token operator\">~</span><span class=\"token punctuation\">]</span># \n<span class=\"token punctuation\">[</span>root@jenkins <span class=\"token operator\">~</span><span class=\"token punctuation\">]</span># </code></pre></div>\n<p>NFS끼리 잘 연결되어있는걸 확인했습니다!!</p>\n</li>\n</ul>\n<br/>\n<p><code class=\"language-text\">FileStore를 이용한 NFS 구성은 정말 간단합니다. 비용만아니면 매일 쓰고 싶네요</code></p>\n<br/>\n<hr>\n<h3 id=\"nfs를-gke의-볼륨으로-사용\" style=\"position:relative;\"><a href=\"#nfs%EB%A5%BC-gke%EC%9D%98-%EB%B3%BC%EB%A5%A8%EC%9C%BC%EB%A1%9C-%EC%82%AC%EC%9A%A9\" aria-label=\"nfs를 gke의 볼륨으로 사용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NFS를 GKE의 볼륨으로 사용</h3>\n<p><a href=\"https://cloud.google.com/filestore/docs/accessing-fileshares?hl=ko\">공식 문서</a></p>\n<br/>\n<br/>\n<h3 id=\"pv-생성\" style=\"position:relative;\"><a href=\"#pv-%EC%83%9D%EC%84%B1\" aria-label=\"pv 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PV 생성</h3>\n<ul>\n<li>\n<p>NFS를 볼륨으로 이용하기 위해서 아래와 같은 메니페스트 파일을 작성했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">apiVersion<span class=\"token punctuation\">:</span> <span class=\"token class-name\">v1</span>\nkind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">PersistentVolume</span>\nmetadata<span class=\"token punctuation\">:</span>\n    name<span class=\"token punctuation\">:</span> dbserver\n    <span class=\"token keyword\">namespace</span><span class=\"token punctuation\">:</span> cd<span class=\"token operator\">-</span><span class=\"token class-name\">test</span>\nspec<span class=\"token punctuation\">:</span>\n    capacity<span class=\"token punctuation\">:</span>\n    storage<span class=\"token punctuation\">:</span> 10Gi\nvolumeMode<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Filesystem</span>\naccessModes<span class=\"token punctuation\">:</span>\n<span class=\"token operator\">-</span> <span class=\"token class-name\">ReadWriteMany</span>\npersistentVolumeReclaimPolicy<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Retain</span>\nstorageClassName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\nnfs<span class=\"token punctuation\">:</span>\n    path<span class=\"token punctuation\">:</span> <span class=\"token operator\">/</span><span class=\"token class-name\">nfs_share</span>\n    server<span class=\"token punctuation\">:</span> <span class=\"token number\">10.254</span><span class=\"token number\">.194</span><span class=\"token number\">.122</span></code></pre></div>\n<p>PV를 생성할때 NFS서버의 IP와 path를 제대로 설정해주지 않으면<br>\n아래와 같은 <code class=\"language-text\">NFS MOUNT ERROR</code>가 발생합니다</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">Search\nWarning\tFailedMount\tUnable to attach <span class=\"token keyword\">or</span> <span class=\"token class-name\">mount</span> volumes<span class=\"token punctuation\">:</span> <span class=\"token class-name\">unmounted</span> volumes<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>mysql<span class=\"token operator\">-</span>vol<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">unattached</span> volumes<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token keyword\">default</span><span class=\"token operator\">-</span>token<span class=\"token operator\">-</span>6778k mysql<span class=\"token operator\">-</span>vol<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> timed <span class=\"token keyword\">out</span> waiting <span class=\"token keyword\">for</span> the condition\t<span class=\"token number\">2</span> minutes ago\nWarning\tFailedMount\tMountVolume<span class=\"token punctuation\">.</span>SetUp failed <span class=\"token keyword\">for</span> volume <span class=\"token string\">\"dbserver\"</span> <span class=\"token punctuation\">:</span> <span class=\"token class-name\">mount</span> failed<span class=\"token punctuation\">:</span> exit status <span class=\"token number\">1</span> <span class=\"token class-name\">Mounting</span> command<span class=\"token punctuation\">:</span> systemd<span class=\"token operator\">-</span>run <span class=\"token class-name\">Mounting</span> arguments<span class=\"token punctuation\">:</span> <span class=\"token operator\">--</span>description<span class=\"token operator\">=</span>Kubernetes transient mount <span class=\"token keyword\">for</span> <span class=\"token operator\">/</span><span class=\"token keyword\">var</span><span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span>kubelet<span class=\"token operator\">/</span>pods<span class=\"token operator\">/</span>d28155b1<span class=\"token operator\">-</span>9c27<span class=\"token operator\">-</span>4f6e<span class=\"token operator\">-</span>b1b7<span class=\"token operator\">-</span>9169c926f784<span class=\"token operator\">/</span>volumes<span class=\"token operator\">/</span>kubernetes<span class=\"token punctuation\">.</span>io<span class=\"token operator\">~</span>nfs<span class=\"token operator\">/</span>dbserver <span class=\"token operator\">--</span>scope <span class=\"token operator\">--</span> <span class=\"token operator\">/</span>home<span class=\"token operator\">/</span>kubernetes<span class=\"token operator\">/</span>containerized_mounter<span class=\"token operator\">/</span>mounter mount <span class=\"token operator\">-</span>t nfs <span class=\"token operator\">-</span><span class=\"token class-name\">o</span> hard<span class=\"token punctuation\">,</span>nfsvers<span class=\"token operator\">=</span><span class=\"token number\">3</span> <span class=\"token number\">10.254</span><span class=\"token number\">.194</span><span class=\"token number\">.120</span><span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>file<span class=\"token operator\">-</span>share <span class=\"token operator\">/</span><span class=\"token keyword\">var</span><span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span>kubelet<span class=\"token operator\">/</span>pods<span class=\"token operator\">/</span>d28155b1<span class=\"token operator\">-</span>9c27<span class=\"token operator\">-</span>4f6e<span class=\"token operator\">-</span>b1b7<span class=\"token operator\">-</span>9169c926f784<span class=\"token operator\">/</span>volumes<span class=\"token operator\">/</span>kubernetes<span class=\"token punctuation\">.</span>io<span class=\"token operator\">~</span>nfs<span class=\"token operator\">/</span><span class=\"token class-name\">dbserver</span> Output<span class=\"token punctuation\">:</span> Running scope <span class=\"token keyword\">as</span> <span class=\"token class-name\">unit</span><span class=\"token punctuation\">:</span> run<span class=\"token operator\">-</span>r3af88159402a4b1ab6bc70512f1cbc1d<span class=\"token punctuation\">.</span>scope <span class=\"token class-name\">Mount</span> failed<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mount</span> failed<span class=\"token punctuation\">:</span> exit status <span class=\"token number\">32</span> <span class=\"token class-name\">Mounting</span> command<span class=\"token punctuation\">:</span> chroot <span class=\"token class-name\">Mounting</span> arguments<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">/</span>home<span class=\"token operator\">/</span>kubernetes<span class=\"token operator\">/</span>containerized_mounter<span class=\"token operator\">/</span>rootfs mount <span class=\"token operator\">-</span>t nfs <span class=\"token operator\">-</span><span class=\"token class-name\">o</span> hard<span class=\"token punctuation\">,</span>nfsvers<span class=\"token operator\">=</span><span class=\"token number\">3</span> <span class=\"token number\">10.254</span><span class=\"token number\">.194</span><span class=\"token number\">.120</span><span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>file<span class=\"token operator\">-</span>share <span class=\"token operator\">/</span><span class=\"token keyword\">var</span><span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span>kubelet<span class=\"token operator\">/</span>pods<span class=\"token operator\">/</span>d28155b1<span class=\"token operator\">-</span>9c27<span class=\"token operator\">-</span>4f6e<span class=\"token operator\">-</span>b1b7<span class=\"token operator\">-</span>9169c926f784<span class=\"token operator\">/</span>volumes<span class=\"token operator\">/</span>kubernetes<span class=\"token punctuation\">.</span>io<span class=\"token operator\">~</span>nfs<span class=\"token operator\">/</span>dbserver<span class=\"token punctuation\">]</span> Output<span class=\"token punctuation\">:</span> mount<span class=\"token punctuation\">.</span>nfs<span class=\"token punctuation\">:</span> Connection timed <span class=\"token keyword\">out</span>\t<span class=\"token number\">2</span> minutes ago</code></pre></div>\n<br/>\n</li>\n<li>추가적으로 storageClassName: \"\" 항목을 None으로 둬야만 합니다.<br>\n그래야 GKE 기본 스토리지 클래스인 GCP-PD 형식의 PV를 생성하지 않기 때문에<br>\nNONE이 필수적입니다! 이 항목도 NONE이 아닐 경우 위와 같은 에러가 발생합니다.</li>\n</ul>\n<br/>\n<hr>\n<h3 id=\"pvc-생성\" style=\"position:relative;\"><a href=\"#pvc-%EC%83%9D%EC%84%B1\" aria-label=\"pvc 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PVC 생성</h3>\n<ul>\n<li>\n<p>NFS를 볼륨으로 이용하기 위해서 아래와 같은 메니페스트 파일을 작성했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">apiVersion<span class=\"token punctuation\">:</span> <span class=\"token class-name\">v1</span>\nkind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">PersistentVolumeClaim</span>\nmetadata<span class=\"token punctuation\">:</span>\n    creationTimestamp<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\n    labels<span class=\"token punctuation\">:</span>\n        io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\n    name<span class=\"token punctuation\">:</span> mysql<span class=\"token operator\">-</span>pvc\n    <span class=\"token keyword\">namespace</span><span class=\"token punctuation\">:</span> cd<span class=\"token operator\">-</span><span class=\"token class-name\">test</span>\nspec<span class=\"token punctuation\">:</span>\n  accessModes<span class=\"token punctuation\">:</span>\n  <span class=\"token operator\">-</span> <span class=\"token class-name\">ReadWriteMany</span>\n  storageClassName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n  volumeName<span class=\"token punctuation\">:</span> <span class=\"token class-name\">dbserver</span>\n  resources<span class=\"token punctuation\">:</span>\n    requests<span class=\"token punctuation\">:</span>\n      storage<span class=\"token punctuation\">:</span> 5Gi\nstatus<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>PVC의 경우 별로 바꿔줄 것이 없습니다. 다만 <code class=\"language-text\">storageClassName = NONE</code>이기 때문에<br>\n<code class=\"language-text\">volumeName: dbserver</code> 항목으로 PV를 잡아주어야 원할하게 바운딩 됩니다!</p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>그럼 PVC를 생성했으니 PV &#x3C;-> PVC가 바운딩되었는지 확인해봅시다</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token operator\">></span> kubectl <span class=\"token keyword\">get</span> pv <span class=\"token operator\">-</span>n cd<span class=\"token operator\">-</span>test\nNAME       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM               STORAGECLASS   REASON   AGE\ndbserver   10Gi       RWX            Retain           Bound    cd<span class=\"token operator\">-</span>test<span class=\"token operator\">/</span>mysql<span class=\"token operator\">-</span>pvc                           <span class=\"token number\">28m</span>\n<span class=\"token operator\">></span> kubectl <span class=\"token keyword\">get</span> pvc <span class=\"token operator\">-</span>n cd<span class=\"token operator\">-</span>test\nNAME        STATUS   VOLUME     CAPACITY   ACCESS MODES   STORAGECLASS   AGE\nmysql<span class=\"token operator\">-</span>pvc   Bound    dbserver   10Gi       RWX                           <span class=\"token number\">28m</span></code></pre></div>\n<p>너무 정상적입니다~ 이제 MYSQL POD를 배포해봅시다!</p>\n</li>\n</ul>\n<br/>\n<hr>\n<h3 id=\"mysql-pod-배포\" style=\"position:relative;\"><a href=\"#mysql-pod-%EB%B0%B0%ED%8F%AC\" aria-label=\"mysql pod 배포 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MYSQL POD 배포</h3>\n<br/>\n<ul>\n<li>\n<p>MYSQL 배포를 위해 아래와 같은 메니페스트 파일을 작성했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">apiVersion<span class=\"token punctuation\">:</span> apps<span class=\"token operator\">/</span><span class=\"token class-name\">v1</span>\nkind<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Deployment</span>\nmetadata<span class=\"token punctuation\">:</span>\nannotations<span class=\"token punctuation\">:</span>\n    kompose<span class=\"token punctuation\">.</span>cmd<span class=\"token punctuation\">:</span> kompose convert\n    kompose<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">:</span> <span class=\"token number\">1.21</span><span class=\"token number\">.0</span> <span class=\"token punctuation\">(</span>992df58d8<span class=\"token punctuation\">)</span>\ncreationTimestamp<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\nlabels<span class=\"token punctuation\">:</span>\n    io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\nname<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\nspec<span class=\"token punctuation\">:</span>\nreplicas<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\nselector<span class=\"token punctuation\">:</span>\n    matchLabels<span class=\"token punctuation\">:</span>\n    io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\nstrategy<span class=\"token punctuation\">:</span>\n    type<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Recreate</span>\ntemplate<span class=\"token punctuation\">:</span>\n    metadata<span class=\"token punctuation\">:</span>\n    annotations<span class=\"token punctuation\">:</span>\n        kompose<span class=\"token punctuation\">.</span>cmd<span class=\"token punctuation\">:</span> kompose convert\n        kompose<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">:</span> <span class=\"token number\">1.21</span><span class=\"token number\">.0</span> <span class=\"token punctuation\">(</span>992df58d8<span class=\"token punctuation\">)</span>\n    creationTimestamp<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\n    labels<span class=\"token punctuation\">:</span>\n        io<span class=\"token punctuation\">.</span>kompose<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\n    spec<span class=\"token punctuation\">:</span>\n    containers<span class=\"token punctuation\">:</span>\n    <span class=\"token operator\">-</span> env<span class=\"token punctuation\">:</span>\n        <span class=\"token operator\">-</span> name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">MYSQL_ROOT_PASSWORD</span>\n        <span class=\"token keyword\">value</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>비번은 안댑니다<span class=\"token punctuation\">]</span>\n        image<span class=\"token punctuation\">:</span> mysql<span class=\"token punctuation\">:</span><span class=\"token number\">5.5</span>\n        imagePullPolicy<span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n        name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">mysql</span>\n        resources<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n        volumeMounts<span class=\"token punctuation\">:</span>\n        <span class=\"token operator\">-</span> mountPath<span class=\"token punctuation\">:</span> <span class=\"token operator\">/</span><span class=\"token keyword\">var</span><span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span><span class=\"token class-name\">mysql</span>\n        name<span class=\"token punctuation\">:</span> mysql<span class=\"token operator\">-</span><span class=\"token class-name\">vol</span>\n    restartPolicy<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Always</span>\n    serviceAccountName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    volumes<span class=\"token punctuation\">:</span>\n    <span class=\"token operator\">-</span> name<span class=\"token punctuation\">:</span> mysql<span class=\"token operator\">-</span><span class=\"token class-name\">vol</span>\n        persistentVolumeClaim<span class=\"token punctuation\">:</span>\n        claimName<span class=\"token punctuation\">:</span> mysql<span class=\"token operator\">-</span><span class=\"token class-name\">pvc</span>\n    status<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>다음과 같은 배포 메니페스트로 배포를 하면! 아래와 같이 정상적으로 구동이 됩니다!!</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/96962891-a7aba180-1542-11eb-9d2d-3eb34c814aed.png\" alt=\"스크린샷, 2020-10-23 15-15-52\"></p>\n</li>\n</ul>\n<br/>\n<hr>\n<h3 id=\"에러-발생ㅠ\" style=\"position:relative;\"><a href=\"#%EC%97%90%EB%9F%AC-%EB%B0%9C%EC%83%9D%E3%85%A0\" aria-label=\"에러 발생ㅠ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>에러 발생..ㅠ</h3>\n<p><code class=\"language-text\">MYSQL Unable to lock ./ib_logfile0, error: 11</code></p>\n<br/>\n<ul>\n<li>\n<p>MYSQL Deployment에 Replicas 를 2로 설정 후 이중화를 하려니깐 아래와 같은 ERROR가 발생하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token number\">201023</span>  <span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token number\">30</span><span class=\"token punctuation\">:</span><span class=\"token number\">32</span> <span class=\"token punctuation\">[</span>Note<span class=\"token punctuation\">]</span> <span class=\"token operator\">--</span>secure<span class=\"token operator\">-</span>file<span class=\"token operator\">-</span>priv <span class=\"token keyword\">is</span> <span class=\"token keyword\">set</span> to NULL<span class=\"token punctuation\">.</span> Operations related to importing <span class=\"token keyword\">and</span> exporting data are disabled\n<span class=\"token number\">201023</span>  <span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token number\">30</span><span class=\"token punctuation\">:</span><span class=\"token number\">32</span> <span class=\"token punctuation\">[</span>Note<span class=\"token punctuation\">]</span> mysqld <span class=\"token punctuation\">(</span>mysqld <span class=\"token number\">5.5</span><span class=\"token number\">.62</span><span class=\"token punctuation\">)</span> starting <span class=\"token keyword\">as</span> <span class=\"token class-name\">process</span> <span class=\"token number\">1</span> <span class=\"token range operator\">..</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">201023</span>  <span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token number\">30</span><span class=\"token punctuation\">:</span><span class=\"token number\">32</span> <span class=\"token punctuation\">[</span>Note<span class=\"token punctuation\">]</span> Plugin 'FEDERATED' <span class=\"token keyword\">is</span> <span class=\"token class-name\">disabled</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">201023</span>  <span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token number\">30</span><span class=\"token punctuation\">:</span><span class=\"token number\">32</span> InnoDB<span class=\"token punctuation\">:</span> The InnoDB memory heap <span class=\"token keyword\">is</span> <span class=\"token class-name\">disabled</span>\n<span class=\"token number\">201023</span>  <span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token number\">30</span><span class=\"token punctuation\">:</span><span class=\"token number\">32</span> InnoDB<span class=\"token punctuation\">:</span> Mutexes <span class=\"token keyword\">and</span> rw_locks use GCC atomic builtins\n<span class=\"token number\">201023</span>  <span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token number\">30</span><span class=\"token punctuation\">:</span><span class=\"token number\">32</span> InnoDB<span class=\"token punctuation\">:</span> Compressed tables use zlib <span class=\"token number\">1.2</span><span class=\"token number\">.11</span>\n<span class=\"token number\">201023</span>  <span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token number\">30</span><span class=\"token punctuation\">:</span><span class=\"token number\">32</span> InnoDB<span class=\"token punctuation\">:</span> Using Linux native AIO\n<span class=\"token number\">201023</span>  <span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token number\">30</span><span class=\"token punctuation\">:</span><span class=\"token number\">32</span> InnoDB<span class=\"token punctuation\">:</span> Initializing <span class=\"token class-name\">buffer</span> pool<span class=\"token punctuation\">,</span> size <span class=\"token operator\">=</span> <span class=\"token number\">128.0M</span>\n<span class=\"token number\">201023</span>  <span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token number\">30</span><span class=\"token punctuation\">:</span><span class=\"token number\">32</span> InnoDB<span class=\"token punctuation\">:</span> Completed initialization of buffer <span class=\"token class-name\">pool</span>\nInnoDB<span class=\"token punctuation\">:</span> Unable to <span class=\"token keyword\">lock</span> <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>ib_logfile0<span class=\"token punctuation\">,</span> <span class=\"token named-parameter punctuation\">error</span><span class=\"token punctuation\">:</span> <span class=\"token number\">11</span>\nInnoDB<span class=\"token punctuation\">:</span> Check that you <span class=\"token keyword\">do</span> <span class=\"token keyword\">not</span> already have another mysqld <span class=\"token class-name\">process</span>\nInnoDB<span class=\"token punctuation\">:</span> <span class=\"token keyword\">using</span> the same InnoDB data <span class=\"token keyword\">or</span> log files<span class=\"token punctuation\">.</span>\nInnoDB<span class=\"token punctuation\">:</span> Error <span class=\"token keyword\">in</span> opening <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>ib_logfile0\n<span class=\"token number\">201023</span>  <span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token number\">30</span><span class=\"token punctuation\">:</span><span class=\"token number\">32</span> <span class=\"token punctuation\">[</span>ERROR<span class=\"token punctuation\">]</span> Plugin 'InnoDB' init function returned error<span class=\"token punctuation\">.</span>\n<span class=\"token number\">201023</span>  <span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token number\">30</span><span class=\"token punctuation\">:</span><span class=\"token number\">32</span> <span class=\"token punctuation\">[</span>ERROR<span class=\"token punctuation\">]</span> Plugin 'InnoDB' registration <span class=\"token keyword\">as</span> <span class=\"token class-name\">a</span> STORAGE ENGINE failed<span class=\"token punctuation\">.</span>\n<span class=\"token number\">201023</span>  <span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token number\">30</span><span class=\"token punctuation\">:</span><span class=\"token number\">32</span> <span class=\"token punctuation\">[</span>ERROR<span class=\"token punctuation\">]</span> Unknown<span class=\"token operator\">/</span>unsupported <span class=\"token class-name\">storage</span> engine<span class=\"token punctuation\">:</span> InnoDB\n<span class=\"token number\">201023</span>  <span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token number\">30</span><span class=\"token punctuation\">:</span><span class=\"token number\">32</span> <span class=\"token punctuation\">[</span>ERROR<span class=\"token punctuation\">]</span> Aborting\n<span class=\"token number\">201023</span>  <span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token number\">30</span><span class=\"token punctuation\">:</span><span class=\"token number\">32</span> <span class=\"token punctuation\">[</span>Note<span class=\"token punctuation\">]</span> mysqld<span class=\"token punctuation\">:</span> Shutdown complete</code></pre></div>\n</li>\n</ul>\n<br/>\n<ul>\n<li>검색을 쫌 해보니 내 환경은 NFS로 data파일을 받아오는 구조이다 보니 한쪽의 MYSQL Pod가 mysql을 실행시키면서<br>\n해당 데이터파일을 사용하고 있으면 다른쪽에서는 사용하지 못하는 이슈였다.</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>Rancher UI에서 확인해보니 컨테이너가 계속 재시작 되고 있다 ㅠㅠ</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/96963063-f35e4b00-1542-11eb-8671-2c25c1f6236d.png\" alt=\"스크린샷, 2020-10-23 14-15-19\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>머리말에서도 언급했듯이 이중화보다는 NFS로 DB 데이터를 받아오는 것과 별 차이가 없다고 생각을 했습니다.<br>\n그래서 위의 Mysql 배포 메니페스트 파일의 replicas를 1로 두는 것으로 마무리 했습니다</li>\n</ul>\n<hr>\n<h3 id=\"nfs---mysql-data-연동-확인\" style=\"position:relative;\"><a href=\"#nfs---mysql-data-%EC%97%B0%EB%8F%99-%ED%99%95%EC%9D%B8\" aria-label=\"nfs   mysql data 연동 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NFS &#x3C;-> Mysql Data 연동 확인</h3>\n<p>replicas를 1로 두어 NFS와 데이터파일을 연동한 POD에서 확인해봅시다!</p>\n<ul>\n<li>\n<p>우선 MYSQL과 연동한 취약점 검사 WEB에서 아이디를 하나 만들어보죠 해당 ID 데이터는 MYSQL DB에 저장됩니다</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/96963398-8c8d6180-1543-11eb-8cb1-52c331066848.png\" alt=\"스크린샷, 2020-10-23 15-22-18\"></p>\n<p>test2라는 User를 만들었습니다</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/96963649-f148bc00-1543-11eb-9ff7-25c533985471.png\" alt=\"스크린샷, 2020-10-23 15-25-06\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>MYSQL POD로 가서 데이터를 확인해봅시다.</p>\n<p>아래와 같이 DB Table에 Account 정보가 잘 들어와 있네요</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">mysql<span class=\"token operator\">></span> \nmysql<span class=\"token operator\">></span> <span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> users<span class=\"token punctuation\">;</span>\n<span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">+</span>\n<span class=\"token operator\">|</span> id <span class=\"token operator\">|</span> name  <span class=\"token operator\">|</span> login <span class=\"token operator\">|</span> email           <span class=\"token operator\">|</span> password                         <span class=\"token operator\">|</span> created_at          <span class=\"token operator\">|</span> updated_at          <span class=\"token operator\">|</span> role <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">+</span>\n<span class=\"token operator\">|</span> <span class=\"token number\">18</span> <span class=\"token operator\">|</span> test  <span class=\"token operator\">|</span> test  <span class=\"token operator\">|</span> test@gmail<span class=\"token punctuation\">.</span>com  <span class=\"token operator\">|</span> 098f6bcd4621d373cade4e832627b4f6 <span class=\"token operator\">|</span> <span class=\"token number\">2020</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">23</span> <span class=\"token number\">05</span><span class=\"token punctuation\">:</span><span class=\"token number\">46</span><span class=\"token punctuation\">:</span><span class=\"token number\">19</span> <span class=\"token operator\">|</span> <span class=\"token number\">2020</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">23</span> <span class=\"token number\">05</span><span class=\"token punctuation\">:</span><span class=\"token number\">46</span><span class=\"token punctuation\">:</span><span class=\"token number\">19</span> <span class=\"token operator\">|</span> NULL <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> <span class=\"token number\">19</span> <span class=\"token operator\">|</span> test2 <span class=\"token operator\">|</span> test2 <span class=\"token operator\">|</span> test2@naver<span class=\"token punctuation\">.</span>com <span class=\"token operator\">|</span> ad0234829205b9033196ba818f7a872b <span class=\"token operator\">|</span> <span class=\"token number\">2020</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">23</span> <span class=\"token number\">06</span><span class=\"token punctuation\">:</span><span class=\"token number\">24</span><span class=\"token punctuation\">:</span><span class=\"token number\">54</span> <span class=\"token operator\">|</span> <span class=\"token number\">2020</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">23</span> <span class=\"token number\">06</span><span class=\"token punctuation\">:</span><span class=\"token number\">24</span><span class=\"token punctuation\">:</span><span class=\"token number\">54</span> <span class=\"token operator\">|</span> NULL <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">+</span>\n<span class=\"token number\">2</span> rows <span class=\"token keyword\">in</span> <span class=\"token keyword\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n</ul>\n<br/>\n<hr>\n<h3 id=\"이제-mysql-pod를-강제로-죽인-뒤-다시-가동시켜서-db-data를-확인해보겠습니다\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EC%A0%9C-mysql-pod%EB%A5%BC-%EA%B0%95%EC%A0%9C%EB%A1%9C-%EC%A3%BD%EC%9D%B8-%EB%92%A4-%EB%8B%A4%EC%8B%9C-%EA%B0%80%EB%8F%99%EC%8B%9C%EC%BC%9C%EC%84%9C-db-data%EB%A5%BC-%ED%99%95%EC%9D%B8%ED%95%B4%EB%B3%B4%EA%B2%A0%EC%8A%B5%EB%8B%88%EB%8B%A4\" aria-label=\"이제 mysql pod를 강제로 죽인 뒤 다시 가동시켜서 db data를 확인해보겠습니다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이제 MYSQL POD를 강제로 죽인 뒤 다시 가동시켜서 DB DATA를 확인해보겠습니다</h3>\n<br/>\n<ul>\n<li>\n<p>Rancher에서는 POD를 다음과 같이 간단하게 종료 시킬 수 있습니다.</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/96963953-8ea3f000-1544-11eb-9963-c488299be958.png\" alt=\"스크린샷, 2020-10-23 15-29-29\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>Deployement가 POD를 재시작 시켜 이전과 다른 이름으로 컨테이너가 가동 됐습니다.</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/96964025-ad09eb80-1544-11eb-9bd6-0f30336e6e03.png\" alt=\"스크린샷, 2020-10-23 15-30-20\"></p>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>새로 생성된 컨테이너에 접속해서 DB 데이터를 보면 기존에 추가했던 test2 user 정보가 남아있습니다</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">mysql<span class=\"token operator\">></span> use dvja\nReading table information <span class=\"token keyword\">for</span> completion of table <span class=\"token keyword\">and</span> column names\nYou can turn off <span class=\"token keyword\">this</span> feature to <span class=\"token keyword\">get</span> a quicker startup with <span class=\"token operator\">-</span>A\n\nDatabase changed\nmysql<span class=\"token operator\">></span> <span class=\"token class-name\">show</span> tables<span class=\"token punctuation\">;</span>\n<span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">+</span>\n<span class=\"token operator\">|</span> Tables_in_dvja <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">+</span>\n<span class=\"token operator\">|</span> products       <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> users          <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">+</span>\n<span class=\"token number\">2</span> rows <span class=\"token keyword\">in</span> <span class=\"token keyword\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span>\n\nmysql<span class=\"token operator\">></span> \nmysql<span class=\"token operator\">></span> <span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> users<span class=\"token punctuation\">;</span>\n<span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">+</span>\n<span class=\"token operator\">|</span> id <span class=\"token operator\">|</span> name  <span class=\"token operator\">|</span> login <span class=\"token operator\">|</span> email           <span class=\"token operator\">|</span> password                         <span class=\"token operator\">|</span> created_at          <span class=\"token operator\">|</span> updated_at          <span class=\"token operator\">|</span> role <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">+</span>\n<span class=\"token operator\">|</span> <span class=\"token number\">18</span> <span class=\"token operator\">|</span> test  <span class=\"token operator\">|</span> test  <span class=\"token operator\">|</span> test@gmail<span class=\"token punctuation\">.</span>com  <span class=\"token operator\">|</span> 098f6bcd4621d373cade4e832627b4f6 <span class=\"token operator\">|</span> <span class=\"token number\">2020</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">23</span> <span class=\"token number\">05</span><span class=\"token punctuation\">:</span><span class=\"token number\">46</span><span class=\"token punctuation\">:</span><span class=\"token number\">19</span> <span class=\"token operator\">|</span> <span class=\"token number\">2020</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">23</span> <span class=\"token number\">05</span><span class=\"token punctuation\">:</span><span class=\"token number\">46</span><span class=\"token punctuation\">:</span><span class=\"token number\">19</span> <span class=\"token operator\">|</span> NULL <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> <span class=\"token number\">19</span> <span class=\"token operator\">|</span> test2 <span class=\"token operator\">|</span> test2 <span class=\"token operator\">|</span> test2@naver<span class=\"token punctuation\">.</span>com <span class=\"token operator\">|</span> ad0234829205b9033196ba818f7a872b <span class=\"token operator\">|</span> <span class=\"token number\">2020</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">23</span> <span class=\"token number\">06</span><span class=\"token punctuation\">:</span><span class=\"token number\">24</span><span class=\"token punctuation\">:</span><span class=\"token number\">54</span> <span class=\"token operator\">|</span> <span class=\"token number\">2020</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">-</span><span class=\"token number\">23</span> <span class=\"token number\">06</span><span class=\"token punctuation\">:</span><span class=\"token number\">24</span><span class=\"token punctuation\">:</span><span class=\"token number\">54</span> <span class=\"token operator\">|</span> NULL <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">+</span>\n<span class=\"token number\">2</span> rows <span class=\"token keyword\">in</span> <span class=\"token keyword\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span>\n\nmysql<span class=\"token operator\">></span> </code></pre></div>\n</li>\n</ul>\n<br/>\n<ul>\n<li>\n<p>물론 웹페이지에서도 접속이 원활합니다</p>\n<p><img src=\"https://user-images.githubusercontent.com/69498804/96964242-17229080-1545-11eb-8632-0a6251fc34d8.png\" alt=\"스크린샷, 2020-10-23 15-33-20\"></p>\n</li>\n</ul>\n<br/>\n<hr>\n<h2 id=\"마치며\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마치며…</h2>\n<p>이번에 새롭게 FileStore라는 GCP의 기능을 사용해봤습니다.<br>\n진짜 이전에 노가다식으로 했었던 NFS 서버 구성이 너무 무의미해지는 서비스입니다<br>\n이번 실습은 왜 클라우드 서비스 하는지 알 것같은 실습이었습니다<br>\n비록 기존에 생각하던 MYSQL POD의 Active/slave,Heartbeat 방식의 이중화는 못했지만 nfs에서 데이터를 받아오는 것도 만족한 서비스 인 것 같습니다.\n이번 포스트까지 이제 전반적인 서비스 구성을 마무리 지은 것 같습니다.<br>\n이제는 보안툴과 취약점 검사, ARgo-cd 자동화 등을 진행해야겠죠…</p>\n<hr>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#-%EB%B0%9C%EC%83%9D-%EC%9D%B4%EC%8A%88\">✔ 발생 이슈</a></li>\n<li>\n<p><a href=\"#-%EC%9D%B4%EC%A0%9C-gcp%EC%9D%98-nfsfilestore%EB%A5%BC-%EA%B5%AC%EC%84%B1%ED%95%B4%EB%B3%B4%EC%A3%A0\">✌ 이제 GCP의 NFS(Filestore)를 구성해보죠</a></p>\n<ul>\n<li><a href=\"#gcp-nfs-%EC%84%A4%EC%A0%95\">GCP NFS 설정</a></li>\n<li><a href=\"#nfs%EB%A5%BC-gke%EC%9D%98-%EB%B3%BC%EB%A5%A8%EC%9C%BC%EB%A1%9C-%EC%82%AC%EC%9A%A9\">NFS를 GKE의 볼륨으로 사용</a></li>\n<li><a href=\"#pv-%EC%83%9D%EC%84%B1\">PV 생성</a></li>\n<li><a href=\"#pvc-%EC%83%9D%EC%84%B1\">PVC 생성</a></li>\n<li><a href=\"#mysql-pod-%EB%B0%B0%ED%8F%AC\">MYSQL POD 배포</a></li>\n<li><a href=\"#%EC%97%90%EB%9F%AC-%EB%B0%9C%EC%83%9D%E3%85%A0\">에러 발생..ㅠ</a></li>\n<li><a href=\"#nfs---mysql-data-%EC%97%B0%EB%8F%99-%ED%99%95%EC%9D%B8\">NFS &#x3C;-> Mysql Data 연동 확인</a></li>\n<li><a href=\"#%EC%9D%B4%EC%A0%9C-mysql-pod%EB%A5%BC-%EA%B0%95%EC%A0%9C%EB%A1%9C-%EC%A3%BD%EC%9D%B8-%EB%92%A4-%EB%8B%A4%EC%8B%9C-%EA%B0%80%EB%8F%99%EC%8B%9C%EC%BC%9C%EC%84%9C-db-data%EB%A5%BC-%ED%99%95%EC%9D%B8%ED%95%B4%EB%B3%B4%EA%B2%A0%EC%8A%B5%EB%8B%88%EB%8B%A4\">이제 MYSQL POD를 강제로 죽인 뒤 다시 가동시켜서 DB DATA를 확인해보겠습니다</a></li>\n</ul>\n</li>\n<li><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\">마치며…</a></li>\n</ul>\n</div>","frontmatter":{"date":"August 07, 2021","title":"[DEVOPS] - GCP의 FileStore (NFS) 를 PV로 사용해보자","categories":"DevOps CLOUD","author":"nasa1515","emoji":"🤦‍♂️"},"fields":{"slug":"/devops-gcpfilestore/"}},"site":{"siteMetadata":{"siteUrl":"https://nasa1515.com","comments":{"utterances":{"repo":"nasa1515/nasablog"}}}}},"pageContext":{"slug":"/devops-cicd2/","nextSlug":"/gcp-cloudshell/","prevSlug":"/devops-gcpfilestore/"}},"staticQueryHashes":["1073350324","2938748437"]}